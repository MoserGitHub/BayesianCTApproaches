<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bayesian approaches in clinical trials - 2&nbsp; Two-arm non-inferiority setting</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<link href="./references.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Two-arm non-inferiority setting</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayesian approaches in clinical trials</a> 
        <div class="sidebar-tools-main">
    <a href="./Bayesian-approaches-in-clinical-trials.pdf" title="Download PDF" class="sidebar-tool px-1"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Background</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-NI.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Two-arm non-inferiority setting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#binomial-outcome" id="toc-binomial-outcome" class="nav-link active" data-scroll-target="#binomial-outcome"><span class="toc-section-number">2.1</span>  Binomial outcome</a>
  <ul class="collapse">
  <li><a href="#frequentist-approach" id="toc-frequentist-approach" class="nav-link" data-scroll-target="#frequentist-approach"><span class="toc-section-number">2.1.1</span>  Frequentist approach</a></li>
  <li><a href="#hybrid-approach-prior-on-treatment-effect" id="toc-hybrid-approach-prior-on-treatment-effect" class="nav-link" data-scroll-target="#hybrid-approach-prior-on-treatment-effect"><span class="toc-section-number">2.1.2</span>  Hybrid approach: Prior on treatment effect</a></li>
  <li><a href="#proper-bayesian-approach" id="toc-proper-bayesian-approach" class="nav-link" data-scroll-target="#proper-bayesian-approach"><span class="toc-section-number">2.1.3</span>  Proper Bayesian approach</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Two-arm non-inferiority setting</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this section we consider a non-inferiority clinical trial setting with a null hypothesis <span class="math inline">\(H_0: \delta &gt; \delta^*\)</span> and alternative hypothesis <span class="math inline">\(H_a: \delta \leq \delta^*\)</span>, where <span class="math inline">\(\delta^*&gt;0\)</span> is a fixed non-inferiority margin and a treatment effect <span class="math inline">\(\delta\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="binomial-outcome" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="binomial-outcome"><span class="header-section-number">2.1</span> Binomial outcome</h2>
<p>Here <span class="math inline">\(p_i\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>, are event probabilities from two treatment arms. <span class="math inline">\(\delta=p_1-p_0\)</span> is the true treatment effect expressed as a risk difference.</p>
<hr>
<p><strong>Working example</strong></p>
<p>We use the SAFE-SSPE trial as a working example <span class="citation" data-cites="Baumgartner2020">[<a href="references.html#ref-Baumgartner2020" role="doc-biblioref">1</a>]</span>. In brief, this non-inferiority randomised placebo-controlled trial compares clinical surveillance versus anticoagulant treatment in low-risk patients with isolated subsegmental pulmonary embolism (SSPE). The primary outcome is 3-month recurrence of venous thromboembolism (VTE). The null hypothesis <span class="math inline">\(H_0\)</span> is ‘clinical surveillance is inferior to anticoagulant treatment’ versus the alternative hypothesis <span class="math inline">\(H_a\)</span> ‘clinical surveillance is non-inferior to anticoagulant treatment’. The non-inferiority margin was set at 3.5% and it was assumed that the proportion of VTE in both groups was 1%.</p>
<hr>
<section id="frequentist-approach" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="frequentist-approach"><span class="header-section-number">2.1.1</span> Frequentist approach</h3>
<p>Let <span class="math inline">\(Y_{i,k} \sim^{iid} Bernoulli(p_i)\)</span>, <span class="math inline">\(k=1,\dots,n_i\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>. Let <span class="math inline">\(\overline p_i=\frac{1}{n_i}\sum_{k\leq n_i} Y_{i,k}\)</span>, <span class="math inline">\(i\in {0,1}\)</span>, and thus the estimated risk difference <span class="math inline">\(D=\overline p_1-\overline p_0\)</span> is Gaussian distributed with <span class="math inline">\(D \sim N\left(\delta, \frac{\sigma_1^2}{n_1}+\frac{\sigma_0^2}{n_0}\right)\)</span>, where <span class="math inline">\(\sigma_i^2=p_i(1-p_i)\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>. For notational purposes we denote <span class="math inline">\(\sigma_{treat}^2=\frac{\sigma_1^2}{n_1}+\frac{\sigma_0^2}{n_0}\)</span>, that is, the variance for the estimated treatment effect.</p>
<p>We are interested whether the upper <span class="math inline">\((1-\alpha)\%\)</span>-confidence limit is smaller than the non-inferiority margin, that is, <span class="math display">\[
D+z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}\leq \delta^*,
\]</span> where <span class="math inline">\(z_{1-\alpha}=\Phi^{-1}(1-\alpha)\)</span>. Simple algebra leads to <span class="math display">\[
D\leq -z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*.
\]</span> Note that <span class="math inline">\(D_{suc}^{\delta^*}:=-z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*\)</span> is the required risk difference for a ‘successful’ rejection of the null hypothesis. Then <span class="math display">\[
\begin{aligned}
P_\delta(D\leq D_{suc}^{\delta^*})&amp;=\Phi\left(-z_{1-\alpha}-\sqrt{\frac{n_1n_0}{n_0\sigma_1^2+n_1\sigma_0^2}}(\delta-\delta^*)\right) \\
&amp;=\Phi\left(-z_{1-\alpha}-\frac{(\delta-\delta^*)}{\sigma_{treat}}\right),
\end{aligned}
\]</span> since under regularity conditions, <span class="math display">\[
Z=\frac{D-\delta^*}{\sigma_{treat}} \rightarrow N(0,1), \quad \min(n_1,n_0) \rightarrow \infty.
\]</span> <span class="math inline">\(P_{\delta}(D\leq D_{suc}^{\delta^*})\)</span> is the **‘probability of rejection given** <span class="math inline">\(\delta\)</span>’. Under the null value <span class="math inline">\(\delta_0=p_1-p_0\)</span>, <span class="math inline">\(P_{\delta_0}(D\leq D_{suc}^{\delta^*})=\alpha\)</span> is the ‘type-I error’ and under an alternative value <span class="math inline">\(\delta_A\)</span>, <span class="math inline">\(P_{\delta_A}(D\leq D_{suc}^{\delta^*})=1-\beta\)</span> is the ‘frequentist power’.</p>
<p>For an alternative value <span class="math inline">\(\delta_A\)</span> it holds that</p>
<p><span class="math display">\[
-z_{1-\alpha}-\sqrt{\frac{n_1n_0}{n_0\sigma_1^2+n_1\sigma_0^2}}(\delta_A-\delta^*)=\Phi^{-1}(1-\beta)=z_{1-\beta}
\]</span> and so the sample size can then be derived as <span class="math display">\[
\frac{(z_{1-\beta}+z_{1-\alpha})^2}{(\delta_A-\delta^*)^2}=\frac{an_0^2}{n_0\sigma_1^2+an_0\sigma_0^2},
\]</span> where <span class="math inline">\(a=n_1/n_0\)</span> is an allocation ratio, such that <span class="math display">\[
n_0=(z_{1-\beta}+z_{1-\alpha})^2\frac{\sigma_1^2+a\sigma_0^2}{a(\delta_A-\delta^*)^2}, \quad n_1=an_0.
\]</span></p>
<p><span class="math inline">\(\delta_0\)</span>, <span class="math inline">\(\delta_A\)</span> and <span class="math inline">\(\delta^*\)</span> are assumed as fixed and known constants in a frequentist approach. Their choices are of high importance, because all trial conclusions are based on those choices and affect the sample size calculation. The plot below shows how the sample size increase as <span class="math inline">\(\delta^*\)</span> approaches <span class="math inline">\(\delta\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We calculate the required sample size for the SAFE-SSPE trial under the following parameters:</p>
<ul>
<li><span class="math inline">\(p_1=0.01\)</span>, <span class="math inline">\(p_0=0.01\)</span>, <span class="math inline">\(\delta^*=0.035\)</span>, <span class="math inline">\(1-\beta=0.8\)</span>, <span class="math inline">\(\alpha=0.05\)</span>, <span class="math inline">\(a=1/1\)</span></li>
</ul>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epiR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: survival</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Package epiR 2.0.58 is loaded</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type help(epi.about) for summary information</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type browseVignettes(package = 'epiR') to learn how to use epiR for applied epidemiological analyses</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>p_0 <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>p_1 <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> p_1<span class="sc">-</span>p_0</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>sd_0 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p_0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_0))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>sd_1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p_1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_1))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">epi.ssninfb</span>(<span class="at">treat=</span>p_1, <span class="at">control=</span>p_0, <span class="at">delta=</span>delta_star, <span class="at">power=</span><span class="dv">1</span><span class="sc">-</span>beta, <span class="at">r=</span>a, <span class="at">alpha=</span>alpha, <span class="at">n=</span><span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$n.total
[1] 200

$n.treat
[1] 100

$n.control
[1] 100

$delta
[1] 0.035

$power
[1] 0.8</code></pre>
</div>
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>n_0 <span class="ot">&lt;-</span> ((<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>beta)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha))<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>((sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>a<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(a<span class="sc">*</span>(delta<span class="sc">-</span>delta_star)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>n_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99.93031</code></pre>
</div>
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">&lt;-</span> n_0<span class="sc">*</span>a</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>n_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99.93031</code></pre>
</div>
</div>
<p>Given the specified operating characteristics and parameters a sample size of 200 patients (100 per arm) is needed to reject the null hypothesis of inferiority. This is more or less the sample size mentioned in the study protocol of the SAFE-SSPE trial but without dropouts and adjustments for rare events.</p>
<hr>
</section>
<section id="hybrid-approach-prior-on-treatment-effect" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="hybrid-approach-prior-on-treatment-effect"><span class="header-section-number">2.1.2</span> Hybrid approach: Prior on treatment effect</h3>
<p>Suppose that the true treatment effect <span class="math inline">\(\delta\)</span> is a realization from a random variable <span class="math inline">\(\Delta\)</span> with <span class="math inline">\(p(\delta)\)</span>. In this subsection we assume that the prior comes from a Gaussian distribution function so that <span class="math inline">\(\Delta \sim N\left(d, \frac{\sigma_1^2+\sigma_0^2}{m}\right)\)</span>. Note that this prior can be thought as a realisation from <span class="math inline">\(m\)</span> Gaussian ‘prior observations’ with variance <span class="math inline">\(\sigma_1^2+\sigma_0^2\)</span>. Again for notational purposes we denote <span class="math inline">\(\sigma_{prior}^2=\frac{\sigma_1^2+\sigma_0^2}{m}\)</span> as the variance of the design prior on the treatment effect.</p>
<p>In the following we will use the following priors:</p>
<ul>
<li><strong>Enthusiastic prior</strong> (favors non-inferiority): <span class="math inline">\(d=0\)</span>, <span class="math inline">\(m=6.6\)</span>, <span class="math inline">\(P(\Delta&gt;\delta^*)=0.05\)</span>. This prior is centered on the treatment effect such that there is a low probability (here 5%) of inferiority.</li>
<li><strong>Skeptical prior</strong> (favors inferiority): <span class="math inline">\(d=\delta^*\)</span>, <span class="math inline">\(m=6.6\)</span>, <span class="math inline">\(P(\Delta&gt;0)=0.05\)</span>. This prior is centered on the non-inferiority margin such that there is a low probability (here 5%) of superiority.</li>
<li><strong>Informative prior</strong> (clinical expert knowledge): <span class="math inline">\(d=0\)</span> with <span class="math inline">\(m=25\)</span>.</li>
<li><strong>Noninformative prior</strong>: <span class="math inline">\(d=0\)</span> with <span class="math inline">\(m=0.5\)</span>.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let <span class="math display">\[
AP:=\int_{\Delta} P_{\delta}(D\leq D_{suc}^{\delta^*})p(\delta)d\delta,
\]</span></p>
<p>be the <strong>‘average power’</strong> <span class="citation" data-cites="Grieve2022">[<a href="references.html#ref-Grieve2022" role="doc-biblioref">2</a>]</span> (also called ‘assurance’ <span class="citation" data-cites="OHagan2005">[<a href="references.html#ref-OHagan2005" role="doc-biblioref">3</a>]</span>, ‘probability of success’ <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">4</a>]</span>, <span class="citation" data-cites="Spiegelhalter2003">[<a href="references.html#ref-Spiegelhalter2003" role="doc-biblioref">5</a>]</span> or Bayesian predictive power <span class="citation" data-cites="Rufibach2016">[<a href="references.html#ref-Rufibach2016" role="doc-biblioref">6</a>]</span>. The supplemental section of <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">4</a>]</span> contains a literature review of the used terminology). Remember that in an hybrid approach we are interested in trial conclusions from a frequentist point of view, thus we are interested in</p>
<p><span class="math display">\[
D\leq -z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*.
\]</span> By using a design prior we take into account the uncertainty of the treatment effect. The prior predictive distribution for an estimated risk difference, say <span class="math inline">\(\tilde D\)</span>, with a prior <span class="math inline">\(\Delta \sim N\left(d, \sigma_{prior}^2\right)\)</span> includes this uncertainty. For the Gaussian case, the prior predictive distribution of <span class="math inline">\(\tilde D\)</span> is given as <span class="math display">\[
\tilde D \sim N\left(d, \sigma_{treat}^2+\sigma_{prior}^2\right),
\]</span> since <span class="math inline">\(\tilde D \sim N\left(\delta, \sigma_{treat}^2\right)\)</span>.</p>
<p>Suppose now that <span class="math inline">\(D\)</span> has a predictive distribution as described above, then <span class="math display">\[
\begin{aligned}
AP&amp;=\int_{-\infty}^{-z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*}f(\tilde\delta)d\tilde\delta= \Phi\left(\frac{1}{\sigma_{prior}}\left[-z_{1-\alpha}\sigma_{treat}-(d-\delta^*)\right]\right)
\end{aligned}
\]</span> see for example <span class="citation" data-cites="Grieve2022">[<a href="references.html#ref-Grieve2022" role="doc-biblioref">2</a>]</span>. Note that as <span class="math inline">\(m \rightarrow \infty\)</span>, then <span class="math inline">\(AP \rightarrow \Phi\left(-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}\right)\)</span>, that is, the frequentist power at <span class="math inline">\(d\)</span>.</p>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We calculate the AP under the assumed prior distributions and parameters for the SAFE-SSPE trial.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Enthusiastic"</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP,<span class="dv">2</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Skeptical"</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP,<span class="dv">2</span>)))</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Informative"</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP,<span class="dv">2</span>)))</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Noninformative"</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP,<span class="dv">2</span>)))</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(data_output <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            type      n_0      n_1   AP
1   Enthusiastic 99.93031 99.93031 0.59
2    Informative 99.93031 99.93031 0.66
3 Noninformative 99.93031 99.93031 0.52
4      Skeptical 99.93031 99.93031 0.34</code></pre>
</div>
</div>
<p>Under an ‘enthusiastic prior’ we get an average power of 59%. For an ‘skeptical prior’ the average power decreases to 34%. These values are lower than the frequentist power of 80%.</p>
<hr>
<p>Rufibach et al.&nbsp;give a closed a formula for the distribution of <span class="math inline">\(RPR:=P_\Delta(D\leq D_{suc}^{\delta^*})\)</span>, where <span class="math inline">\(\Delta \sim N(d,\sigma^2_{prior})\)</span>, and discuss the shape under different prior choices <span class="citation" data-cites="Rufibach2016">[<a href="references.html#ref-Rufibach2016" role="doc-biblioref">6</a>]</span>. In the following we use the wording ’random probability to reject` (RPR) similar to <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">4</a>]</span>.</p>
<p>For <span class="math inline">\(0&lt;y&lt;1\)</span>, the random variable <span class="math inline">\(RPR\)</span> has a probability density function <span class="math display">\[
\begin{aligned}
f(y)&amp;=\frac{\sigma_{treat}}{\sigma_{prior}} \phi\left(-z_{1-\alpha}\frac{\sigma_{treat}}{\sigma_{prior}}-\frac{(d-\delta^*)}{\sigma_{prior}}-\frac{\sigma_{treat}}{\sigma_{prior}}\Phi^{-1}(y) \right)\left[ \phi\left(\Phi^{-1}(y) \right) \right]^{-1},
\end{aligned}
\]</span> see <span class="citation" data-cites="Rufibach2016">[<a href="references.html#ref-Rufibach2016" role="doc-biblioref">6</a>]</span>.</p>
<hr>
<p><strong>Special case</strong></p>
<p>For the case that <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to</p>
<p><span class="math display">\[
\begin{aligned}
f(y)&amp;=\sqrt{\frac{m}{n}}\phi\left(\sqrt{\frac{m}{n}}\left[-z_{1-\alpha}-\sqrt{\frac{n}{2\sigma^2}}(d-\delta^*)-\Phi^{-1}(y)\right] \right)\left[ \phi\left(\Phi^{-1}(y) \right) \right]^{-1}, \quad 0&lt;y&lt;1.
\end{aligned}
\]</span></p>
<hr>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We derive the probability densities for the different assumed priors for the SAFE-SSPE study.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>,<span class="fl">0.999</span>,<span class="fl">0.001</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Rufibach 2016: formula (4)</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(m<span class="sc">*</span>n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>m<span class="sc">*</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span><span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">sqrt</span>(m<span class="sc">*</span>n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>m<span class="sc">*</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(m)<span class="sc">/</span><span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span><span class="fu">sqrt</span>(m<span class="sc">*</span>n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>m<span class="sc">*</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span><span class="fu">qnorm</span>(x))<span class="sc">*</span>(<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y, <span class="at">type=</span><span class="st">"Enthusiastic"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">*</span><span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(sigma_treat<span class="sc">/</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(x))<span class="sc">*</span>(<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(x, y, <span class="at">type=</span><span class="st">"Skeptical"</span>))</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">*</span><span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(sigma_treat<span class="sc">/</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(x))<span class="sc">*</span>(<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(x, y, <span class="at">type=</span><span class="st">"Informative"</span>))</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">*</span><span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(sigma_treat<span class="sc">/</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(x))<span class="sc">*</span>(<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(x, y, <span class="at">type=</span><span class="st">"Noninformative"</span>))</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> data_output <span class="sc">%&gt;%</span> <span class="fu">select</span>(type, <span class="at">x=</span>AP) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">y=</span><span class="dv">0</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>data_power<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_power<span class="sc">$</span>type, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"Enthusiastic"</span>, <span class="st">"Skeptical"</span>, <span class="st">"Informative"</span>, <span class="st">"Noninformative"</span>))</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_power, <span class="fu">aes</span>(x, y, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>)<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">data=</span>data_output2, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="st">"Prior type"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"darkred"</span>))<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"Density"</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"RPR"</span>)<span class="sc">+</span><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))<span class="sc">+</span><span class="fu">labs</span>(<span class="at">caption=</span><span class="st">"Dots indicate the AP."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>The cumulative distribution function of <span class="math inline">\(RPR\)</span> can the be calculated as</p>
<p><span class="math display">\[
\begin{aligned}
P(RPR\leq y)=1-\Phi&amp;\left(\frac{\sigma_{treat}}{\sigma_{prior}}\left[-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}-\Phi^{-1}(y) \right]\right), \quad 0&lt;y&lt;1.
\end{aligned}
\]</span></p>
<hr>
<p><strong>Special case</strong></p>
<p>For the case that <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to</p>
<p><span class="math display">\[
\begin{aligned}
P(RPR\leq y)=1-\Phi&amp;\left(\frac{\sigma_{treat}}{\sigma_{prior}}\left[-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}-\Phi^{-1}(y) \right] \right), \quad 0&lt;y&lt;1.
\end{aligned}
\]</span></p>
<hr>
<p>Note that if <span class="math inline">\(n_0\)</span> and <span class="math inline">\(n_1\)</span> are the planned treatment arm sample sizes from a frequentist power calculation as described in <a href="###-frequentist-approach">Section 2.1.1</a> above, then, if <span class="math inline">\(d=\delta_A\)</span>, <span class="math display">\[
-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}=\Phi^{-1}(y)=\Phi^{-1}(1-\beta) \quad \Rightarrow \quad P(RPR\leq y)=0.5, \quad y=1-\beta.
\]</span></p>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>With the above formula we calculate the probability <span class="math inline">\(P(RPR&gt;\gamma)\)</span>, <span class="math inline">\(0&lt;\gamma&lt;1\)</span>, for the SAFE-SSPE study. We use an enthusiastic (<span class="math inline">\(m=6.6\)</span>), an informative (<span class="math inline">\(m=25\)</span>) and a noninformative prior (<span class="math inline">\(m=0.5\)</span>) prior, all centered on <span class="math inline">\(\delta=0\)</span>.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gamma range</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">0.99</span>,<span class="fl">0.01</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on p1-p0</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">6.6</span>, <span class="dv">25</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> n_0</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(gamma, m_range, n_0_range)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gamma"</span>, <span class="st">"m_range"</span>, <span class="st">"n_0_range"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a<span class="sc">*</span>data_rpr<span class="sc">$</span>n_0_range</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_0_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_1_range)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>data_rpr<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(data_rpr<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(data_rpr<span class="sc">$</span>gamma))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Noninformative"</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="fl">6.6</span>] <span class="ot">&lt;-</span> <span class="st">"Enthusiastic"</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">"Informative"</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on noninferiority margin</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">6.6</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> n_0</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>data_rpr_skep <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(gamma, m_range, n_0_range)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr_skep) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gamma"</span>, <span class="st">"m_range"</span>, <span class="st">"n_0_range"</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a<span class="sc">*</span>data_rpr_skep<span class="sc">$</span>n_0_range</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_0_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_1_range)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>data_rpr_skep<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(data_rpr_skep<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(data_rpr_skep<span class="sc">$</span>gamma))</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Skeptical"</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_rpr, data_rpr_skep)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_rpr<span class="sc">$</span>type, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"Enthusiastic"</span>, <span class="st">"Skeptical"</span>, <span class="st">"Informative"</span>, <span class="st">"Noninformative"</span>))</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_rpr, <span class="fu">aes</span>(<span class="at">x=</span>gamma, <span class="at">y=</span>p_rpr, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="st">"Prior type"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"darkred"</span>))<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"Threshold gamma"</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"Probability that RPR is greater than threshold gamma"</span>)<span class="sc">+</span><span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>))<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>))<span class="sc">+</span><span class="fu">labs</span>(<span class="at">caption=</span><span class="fu">str_glue</span>(<span class="st">"Calculated based on a planned total sample size of "</span>, <span class="fu">round</span>(n_0_range<span class="sc">+</span>a<span class="sc">*</span>n_0_range,<span class="dv">0</span>), <span class="st">"."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For a specific threshold, say <span class="math inline">\(\gamma=0.6\)</span>, and varying ‘prior sample sizes’ <span class="math inline">\(m\)</span> we obtain</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on p1-p0</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">6.6</span>, <span class="dv">25</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">300</span>, <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(m_range, n_0_range)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"m_range"</span>, <span class="st">"n_0_range"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a<span class="sc">*</span>data_rpr<span class="sc">$</span>n_0_range</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_0_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_1_range)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(data_rpr<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_treat)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span><span class="fu">qnorm</span>(gamma)))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Noninformative"</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="fl">6.6</span>] <span class="ot">&lt;-</span> <span class="st">"Enthusiastic"</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">"Informative"</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on noninferiority margin</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">6.6</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">300</span>, <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>data_rpr_skep <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(m_range, n_0_range)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr_skep) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"m_range"</span>, <span class="st">"n_0_range"</span>)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a<span class="sc">*</span>data_rpr_skep<span class="sc">$</span>n_0_range</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_0_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_1_range)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(data_rpr_skep<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_treat)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span><span class="fu">qnorm</span>(gamma)))</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"Skeptical"</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_rpr, data_rpr_skep)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_rpr<span class="sc">$</span>type, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"Enthusiastic"</span>, <span class="st">"Skeptical"</span>, <span class="st">"Informative"</span>, <span class="st">"Noninformative"</span>))</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_rpr, <span class="fu">aes</span>(<span class="at">x=</span>n_1_range<span class="sc">+</span>n_0_range, <span class="at">y=</span>p_rpr, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="st">"Prior type"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"darkred"</span>))<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"Planned total sample size"</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="fu">str_glue</span>(<span class="st">"Probability that RPR is greater than "</span>, gamma<span class="sc">*</span><span class="dv">100</span>, <span class="st">"%"</span>))<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">400</span>))<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">200</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span><span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Note that the average power AP integrates over the whole <span class="math inline">\(\Delta\)</span> range. This might include also ‘non-favorable’ regions. To see that one can decompose AP as follows (see <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">4</a>]</span>, <span class="citation" data-cites="Grieve2022">[<a href="references.html#ref-Grieve2022" role="doc-biblioref">2</a>]</span>): <span class="math display">\[
AP=\overbrace{P(D\leq D_{suc}^{\delta^*}, \Delta&gt;\delta^*)}^{(1)}+\overbrace{P(D\leq D_{suc}^{\delta^*}, 0&lt;\Delta\leq\delta^*)}^{(2)}+\overbrace{P(D\leq D_{suc}^{\delta^*}, \Delta\leq0)}^{(3)}
\]</span> where</p>
<ul>
<li><span class="math inline">\((1)\)</span> Probability of Type-I error,</li>
<li><span class="math inline">\((2)\)</span> ‘Non-inferior, but treatment effect not relevant’,</li>
<li><span class="math inline">\((3)\)</span> ‘Non-inferior, treatment effect relevant’.</li>
</ul>
<p><span class="citation" data-cites="Spiegelhalter2003">[<a href="references.html#ref-Spiegelhalter2003" role="doc-biblioref">5</a>]</span> shows that <span class="math inline">\(AP \approx P(D\leq D_{suc}^{\delta^*}, \Delta\leq0)\)</span> because the type-I error is often small and one has strong believe for the alternative hypothesis <span class="citation" data-cites="Spiegelhalter2003">[<a href="references.html#ref-Spiegelhalter2003" role="doc-biblioref">5</a>]</span>. <span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">4</a>]</span> and <span class="citation" data-cites="OHagan2005">[<a href="references.html#ref-OHagan2005" role="doc-biblioref">3</a>]</span> discuss the relevance of the AP decomposition. For example, pharmaceutical companies might (1)+(2)+(3) taking into account shortterm risk, wheras regulators are interested in (1) or (1)+(2), that is non-inferior outcomes with relevant treatment effects.</p>
<p>For the non-inferiority setting we are interested in (2)+(3):</p>
<p><span class="math display">\[
P(D\leq D_{suc}^{\delta^*}, \Delta\leq\delta^*)=P(D\leq D_{suc}^{\delta^*}|\Delta\leq\delta^*)P(\Delta\leq\delta^*)=\underbrace{E\left[P_{\Delta\leq\delta^*}(D\leq D_{suc}^{\delta^*})\right]}_{EP}P(\Delta\leq\delta^*),
\]</span> Kunzmann et al.&nbsp;denote EP the <strong>‘expected power’</strong> (<span class="citation" data-cites="Kunzmann2022">[<a href="references.html#ref-Kunzmann2022" role="doc-biblioref">4</a>]</span>). Note that</p>
<p><span class="math display">\[
\underbrace{P(D\leq D_{suc}^{\delta^*}, \Delta\leq\delta^*)}_{PAP}=\underbrace{E\left[P_{\Delta\leq\delta^*}(D\leq D_{suc}^{\delta^*})\right]}_{EP}\underbrace{P(\Delta\leq\delta^*)}_{constant}.
\]</span> Spiegelhalter calls <span class="math inline">\(P(P(D\leq D_{suc}^{\delta^*}, \Delta\leq\delta^*)\)</span> the <strong>‘prior adjusted power’</strong> (PAP):</p>
<p>The AP decomposition can be visualised using the posterior predictive distribution. Let <span class="math inline">\(p(\tilde\delta)\)</span> be the pdf of the posterior predictive distribution then <span class="math display">\[
p(\tilde\delta, \delta)= N_2\left(\begin{pmatrix} d \\ d \end{pmatrix}, \begin{pmatrix} \sigma^2_{treat}+\sigma^2_{prior} \quad \sigma^2_{prior} \\ \quad \quad \sigma^2_{prior} \quad \ \quad  \sigma^2_{prior}\end{pmatrix}\right),
\]</span> see formula (2.11) in <span class="citation" data-cites="Grieve2022">[<a href="references.html#ref-Grieve2022" role="doc-biblioref">2</a>]</span>.</p>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>For the SAFE-SSPE study the bivariate scatterplot of <span class="math inline">\(p(\tilde\delta, \delta)\)</span> under an enthusiastic prior can be visualised as:</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>sigma_sim <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1<span class="sc">+</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m), (sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m, (sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m, (sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">byrow=</span>T)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rmvnorm</span>(<span class="at">n=</span><span class="dv">10000</span>, <span class="at">mean=</span><span class="fu">c</span>(prior_mean, prior_mean), sigma_sim))</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_sim) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"delta_pred"</span>, <span class="st">"delta"</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_sim<span class="sc">$</span>delta<span class="sc">&lt;=</span><span class="dv">0</span> <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta_pred<span class="sc">&lt;=-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(n)<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_sim<span class="sc">$</span>delta<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta<span class="sc">&lt;=</span>delta_star <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta_pred<span class="sc">&lt;=-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(n)<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star), <span class="dv">2</span>, data_sim<span class="sc">$</span>region)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_sim<span class="sc">$</span>delta<span class="sc">&gt;</span>delta_star <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta_pred<span class="sc">&lt;=-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(n)<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star), <span class="dv">3</span>, data_sim<span class="sc">$</span>region)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_sim<span class="sc">$</span>region, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"'Not significant'"</span>, <span class="st">"(3)"</span>, <span class="st">"(2)"</span>, <span class="st">"(1)"</span>))</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_sim, <span class="fu">aes</span>(<span class="at">x=</span>delta, <span class="at">y=</span>delta_pred, <span class="at">colour=</span><span class="fu">factor</span>(region)))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.3</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.035</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span><span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(n)<span class="sc">-</span>(prior_mean_enthusiastic<span class="sc">-</span>delta_star), <span class="at">linetype=</span><span class="st">"dotted"</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">caption=</span><span class="st">"Dashed line: Noninferiority margin.</span><span class="sc">\n</span><span class="st">Dotted line: Upper confidence interval from mean of predicted delta &lt;= non-inferiority margin."</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"Predictive distribution of Delta"</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"Delta"</span>)<span class="sc">+</span><span class="fu">scale_color_brewer</span>(<span class="st">"Region"</span>, <span class="at">palette=</span><span class="st">"Reds"</span>)<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.2</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(data_sim <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">prop=</span><span class="fu">n</span>()<span class="sc">/</span><span class="fu">nrow</span>(data_sim)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             region   prop
1 'Not significant' 0.4194
2               (3) 0.4797
3               (2) 0.0996
4               (1) 0.0013</code></pre>
</div>
</div>
<p>For the noninferiority setting <span class="math inline">\(\Delta\leq\delta^*\)</span>:</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>sd_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>n_1)<span class="sc">/</span><span class="fu">sqrt</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>(draws<span class="sc">-</span>delta_star))</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ep=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star]), <span class="at">pap=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star])<span class="sc">*</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">ap=</span><span class="fu">mean</span>(power_classic), <span class="at">const=</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">type=</span><span class="st">"Skeptical"</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(n)<span class="sc">/</span>sd_tilde<span class="sc">*</span>(draws<span class="sc">-</span>delta_star))</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_ep, <span class="fu">data.frame</span>(<span class="at">ep=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star]), <span class="at">pap=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star])<span class="sc">*</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">ap=</span><span class="fu">mean</span>(power_classic), <span class="at">const=</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">type=</span><span class="st">"Enthusiastic"</span>))</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(n)<span class="sc">/</span>sd_tilde<span class="sc">*</span>(draws<span class="sc">-</span>delta_star))</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_ep, <span class="fu">data.frame</span>(<span class="at">ep=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star]), <span class="at">pap=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star])<span class="sc">*</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">ap=</span><span class="fu">mean</span>(power_classic), <span class="at">const=</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">type=</span><span class="st">"Informative"</span>))</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100000</span>, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fl">0.5</span>))</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(n)<span class="sc">/</span>sd_tilde<span class="sc">*</span>(draws<span class="sc">-</span>delta_star))</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_ep, <span class="fu">data.frame</span>(<span class="at">ep=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star]), <span class="at">pap=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star])<span class="sc">*</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">ap=</span><span class="fu">mean</span>(power_classic), <span class="at">const=</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">type=</span><span class="st">"Noninformative"</span>))</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>ep <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>ep, <span class="dv">4</span>)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>ap <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>ap, <span class="dv">4</span>)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>pap <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>pap, <span class="dv">4</span>)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>const <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>const, <span class="dv">4</span>)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>data_ep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      ep    pap     ap  const           type
1 0.7930 0.5857 0.5872 0.7386      Skeptical
2 0.6741 0.3370 0.3437 0.5000   Enthusiastic
3 0.7931 0.5858 0.5872 0.7386    Informative
4 0.9186 0.6785 0.5233 0.7386 Noninformative</code></pre>
</div>
</div>
<hr>
</section>
<section id="proper-bayesian-approach" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="proper-bayesian-approach"><span class="header-section-number">2.1.3</span> Proper Bayesian approach</h3>
<p>A proper Bayesian approach uses the posterior distribution to define ‘Bayesian significance’: <span class="math inline">\(S^B:=P(\Delta\leq\delta^*|data)=1-\epsilon\)</span>. Remember <span class="math inline">\(D=p_1-p_0\)</span> with <span class="math inline">\(D \sim N(\delta, \sigma^2_{treat})\)</span>. Suppose that <span class="math inline">\(\Delta \sim N(d, \sigma^2_{prior})\)</span> then the posterior distribution given <span class="math inline">\(D\)</span> is distributed as <span class="math display">\[
\begin{aligned}
\Delta|D \sim N\left(\frac{\frac{d}{\sigma^2_{prior}}+\frac{D}{\sigma^2_{treat}}}{\frac{1}{\sigma^2_{prior}}+\frac{1}{\sigma^2_{treat}}}, \frac{1}{\frac{1}{\sigma^2_{prior}}+\frac{1}{\sigma^2_{treat}}}\right)=N\left( \frac{\sigma^2_{treat}d+\sigma^2_{prior}D}{\sigma^2_{treat}+\sigma^2_{prior}}, \frac{\sigma^2_{treat}\sigma^2_{prior}}{\sigma^2_{treat}+\sigma^2_{prior}}  \right)
\end{aligned}
\]</span></p>
<hr>
<p><strong>Special case</strong></p>
<p>If <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to</p>
<p><span class="math display">\[
\Delta|D \sim N\left(\frac{m\delta+nD}{n+m}, \frac{\sigma^2}{n+m} \right).
\]</span></p>
<hr>
<p>One is interested whether the upper <span class="math inline">\((1-\epsilon)\)</span> credible interval is smaller than the non-inferiority margin, that is</p>
<p><span class="math display">\[
\frac{\sigma^2_{treat}d+\sigma^2_{prior}D}{\sigma^2_{treat}+\sigma^2_{prior}}+z_{1-\epsilon}\frac{\sigma_{treat}\sigma_{prior}}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}\leq \delta^*.
\]</span> A simple algebraic step gives</p>
<p><span class="math display">\[
\begin{aligned}
D\leq -z_{1-\epsilon}&amp;\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d
\end{aligned}
\]</span> Denote <span class="math inline">\(D_{suc}^{d,\delta^*}=-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d\)</span> as the required risk difference for a successful rejection of the null hypothesis in the Bayesian setting.</p>
<p>Thus, since <span class="math inline">\(D\sim N(\delta, \sigma_{treat}^2)\)</span>, <span class="math display">\[
\begin{aligned}
P(D\leq D_{suc}^{d,\delta^*}|\delta)&amp;=\Phi\left(-z_{1-\epsilon}\sqrt{1+\frac{\sigma^2_{treat}}{\sigma_{prior}^2}}-\frac{1}{\sigma_{treat}}\left[\delta-\delta^*\left\{ 1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2} \right\} \right]-\frac{\sigma_{treat}}{\sigma_{prior}^2}d \right).
\end{aligned}
\]</span> This is the Bayesian power (or probability of rejection) assuming one knows the true treatment effect <span class="math inline">\(\delta\)</span>. Note that this is a conditional probability.</p>
<hr>
<p><strong>Special case</strong></p>
<p>If <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to <span class="math display">\[
\begin{aligned}
P(S^B|\delta)&amp;=\Phi\left(-z_{1-\epsilon}\sqrt{\frac{n+m}{n}}- \frac{m}{\sqrt{2n\sigma^2}}d-\sqrt{\frac{n}{2n\sigma^2}}\left\{\delta-\delta^*\left(\frac{n+m}{n} \right)\right\} \right).
\end{aligned}
\]</span></p>
<hr>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We derive the Bayesian probability of rejection for the SAFE-SSPE study for differently assumed <span class="math inline">\(\delta\)</span> values.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Delta range</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.001</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Epsilon</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>epsilon)<span class="sc">*</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))))<span class="sc">-</span>(m<span class="sc">*</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>prior_mean<span class="sc">-</span><span class="fu">sqrt</span>((n_1<span class="sc">*</span>n_0)<span class="sc">/</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span>(delta<span class="sc">-</span>delta_star<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(delta, <span class="at">y=</span>ap_bayes, <span class="at">type=</span><span class="st">"Bayes: Enthusiastic"</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>epsilon)<span class="sc">*</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))))<span class="sc">-</span>(m<span class="sc">*</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>prior_mean<span class="sc">-</span><span class="fu">sqrt</span>((n_1<span class="sc">*</span>n_0)<span class="sc">/</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span>(delta<span class="sc">-</span>delta_star<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y=</span>ap_bayes, <span class="at">type=</span><span class="st">"Bayes: Skeptical"</span>))</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>epsilon)<span class="sc">*</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))))<span class="sc">-</span>(m<span class="sc">*</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>prior_mean<span class="sc">-</span><span class="fu">sqrt</span>((n_1<span class="sc">*</span>n_0)<span class="sc">/</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span>(delta<span class="sc">-</span>delta_star<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y=</span>ap_bayes, <span class="at">type=</span><span class="st">"Bayes: Informative"</span>))</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>epsilon)<span class="sc">*</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))))<span class="sc">-</span>(m<span class="sc">*</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>prior_mean<span class="sc">-</span><span class="fu">sqrt</span>((n_1<span class="sc">*</span>n_0)<span class="sc">/</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span>(delta<span class="sc">-</span>delta_star<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y=</span>ap_bayes, <span class="at">type=</span><span class="st">"Bayes: Noninformative"</span>))</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequentist</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>y_freq <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span>(delta<span class="sc">-</span>delta_star)<span class="sc">*</span><span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">/</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha))</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y=</span>y_freq, <span class="at">type=</span><span class="st">"Frequentist"</span>))</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>data_power<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_power<span class="sc">$</span>type, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"Bayes: Enthusiastic"</span>, <span class="st">"Bayes: Skeptical"</span>, <span class="st">"Bayes: Informative"</span>, <span class="st">"Bayes: Noninformative"</span>, <span class="st">"Frequentist"</span>))</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_power, <span class="fu">aes</span>(<span class="at">x=</span>delta, <span class="at">y=</span>y, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">geom_line</span>()<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="st">"Type"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"darkred"</span>, <span class="st">"green"</span>))<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"Probability of rejection"</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"Probability to reject"</span>)<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.025</span>,<span class="dv">0</span>,<span class="fl">0.035</span>,<span class="fl">0.050</span>))<span class="sc">+</span><span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="dv">1</span>))<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="fu">str_glue</span>(<span class="st">"For treatment arm sample sizes: n0="</span>, <span class="fu">round</span>(n_0,<span class="dv">0</span>), <span class="st">", n1="</span>, <span class="fu">round</span>(n_1,<span class="dv">0</span>)))<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.035</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="01-NI_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data_power<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">round</span>(data_power<span class="sc">$</span>y, <span class="dv">2</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>data_power <span class="sc">%&gt;%</span> <span class="fu">filter</span>(delta<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"0.035"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   delta    y                  type
1  0.000 0.83   Bayes: Enthusiastic
2  0.035 0.06   Bayes: Enthusiastic
3  0.000 0.78      Bayes: Skeptical
4  0.035 0.04      Bayes: Skeptical
5  0.000 0.90    Bayes: Informative
6  0.035 0.11    Bayes: Informative
7  0.000 0.80 Bayes: Noninformative
8  0.035 0.05 Bayes: Noninformative
9  0.000 0.80           Frequentist
10 0.035 0.05           Frequentist</code></pre>
</div>
</div>
<hr>
<p>The average (marginal) Bayesian probability of rejection (BAP) can be calculated as <span class="math display">\[
\begin{aligned}
BAP&amp;=\int_{-\infty}^{-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d} f(\tilde \delta)d\tilde \delta
\\&amp;=\Phi\left( -z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\frac{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}+\frac{\delta^*}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}\left\{1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right\} \right. \\
  &amp; \left. \quad \quad \quad-\frac{d}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}\left\{1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right\}\right) \\
&amp;=\Phi\left(-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}-\frac{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}{\sigma^2_{prior}}(d-\delta^*)\right),
\end{aligned}
\]</span> since for the posterior predictive distribution <span class="math inline">\(\tilde D \sim N(d, \sigma_{treat}^2+\sigma_{prior}^2)\)</span>.</p>
<hr>
<p><strong>Special case</strong></p>
<p>If <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to <span class="math display">\[
\begin{aligned}
BAP&amp;=-z_{1-\epsilon}\sqrt{\frac{m}{n}}-\sqrt{\frac{(m+n)m}{2n\sigma^2}}(d-\delta^*)
\end{aligned}
\]</span></p>
<hr>
<hr>
<p><strong>Working example (continued)</strong></p>
<p>We derive the average Bayesian probability of rejection for the SAFE-SSPE study.</p>
<div class="cell">
<details>
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Hybrid AP</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Enthusiastic"</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP, <span class="dv">3</span>))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Skeptical"</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP, <span class="dv">3</span>)))</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Informative"</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP, <span class="dv">3</span>)))</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Noninformative"</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP, <span class="dv">3</span>)))</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> data_output <span class="sc">%&gt;%</span> <span class="fu">select</span>(type, n_0, n_1, AP)</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="do">### Bayesian AP</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span><span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star))</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Enthusiastic"</span>, n_0, n_1, <span class="at">AP_bayes=</span><span class="fu">round</span>(ap_bayes, <span class="dv">3</span>))</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span><span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star))</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output2, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Skeptical"</span>, n_0, n_1, <span class="at">AP_bayes=</span><span class="fu">round</span>(ap_bayes, <span class="dv">3</span>)))</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span><span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star))</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output2, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Informative"</span>, n_0, n_1, <span class="at">AP_bayes=</span><span class="fu">round</span>(ap_bayes, <span class="dv">3</span>)))</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span><span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star))</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output2, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">"Noninformative"</span>, n_0, n_1, <span class="at">AP_bayes=</span><span class="fu">round</span>(ap_bayes, <span class="dv">3</span>)))</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data_output, data_output2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(type, AP_bayes), <span class="at">by=</span><span class="st">"type"</span>)</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>data_output <span class="sc">%&gt;%</span> <span class="fu">select</span>(type, n_0, n_1, <span class="at">AP_hybrid=</span>AP, AP_bayes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            type      n_0      n_1 AP_hybrid AP_bayes
1   Enthusiastic 99.93031 99.93031     0.586    0.594
2      Skeptical 99.93031 99.93031     0.336    0.336
3    Informative 99.93031 99.93031     0.663    0.715
4 Noninformative 99.93031 99.93031     0.524    0.524</code></pre>
</div>
</div>
<hr>


<div id="refs" class="references csl-bib-body" role="doc-bibliography" style="display: none">
<div id="ref-Baumgartner2020" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Baumgartner C, Klok FA, Carrier M, Limacher A, Moor J, Righini M, et al. Clinical surveillance vs. Anticoagulation for low-risk patiEnts with isolated SubSegmental pulmonary embolism: Protocol for a multicentre randomised placebo-controlled non-inferiority trial (SAFE-SSPE). BMJ Open. 2020;10: e040151. doi:<a href="https://doi.org/10.1136/bmjopen-2020-040151">10.1136/bmjopen-2020-040151</a></div>
</div>
<div id="ref-Grieve2022" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Grieve AP. Hybrid frequentist/bayesian power and bayesian power in planning clinical trials. Chapman; Hall/CRC; 2022. doi:<a href="https://doi.org/10.1201/9781003218531">10.1201/9781003218531</a></div>
</div>
<div id="ref-OHagan2005" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">O’Hagan A, Stevens JW, Campbell MJ. Assurance in clinical trial design. Pharmaceutical Statistics. 2005;4: 187–201. doi:<a href="https://doi.org/10.1002/pst.175">10.1002/pst.175</a></div>
</div>
<div id="ref-Kunzmann2022" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Kunzmann K, Grayling MJ, Lee KM, Robertson DS, Rufibach K, Wason JMS. A review of bayesian perspectives on sample size derivation for confirmatory trials. The American Statistician. 2021;75: 424–432. doi:<a href="https://doi.org/10.1080/00031305.2021.1901782">10.1080/00031305.2021.1901782</a></div>
</div>
<div id="ref-Spiegelhalter2003" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Spiegelhalter DJ, Abrams KR, Myles JP. Bayesian approaches to clinical trials and health‐care evaluation. Wiley; 2003. doi:<a href="https://doi.org/10.1002/0470092602">10.1002/0470092602</a></div>
</div>
<div id="ref-Rufibach2016" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Rufibach K, Burger HU, Abt M. Bayesian predictive power: Choice of prior and some recommendations for its use as probability of success in drug development. Pharmaceutical Statistics. 2016;15: 438–446. doi:<a href="https://doi.org/10.1002/pst.1764">10.1002/pst.1764</a></div>
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Background</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>