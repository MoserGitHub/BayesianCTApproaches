[
  {
    "objectID": "01-NI.html#background",
    "href": "01-NI.html#background",
    "title": "2  Power and sample size calculations",
    "section": "2.1 Background",
    "text": "2.1 Background\nThe terminology of ‘power’ is often imprecisely used [1]. Kunzmann et al. suggest to use the neutral term ‘probability to reject’. The classical (frequentist) ‘power’ is defined as the probability to reject given that the alternative hypothesis is true. Frequentist power calculations do not include uncertainties of the treatment effect, whereas Bayesian and hybrid approaches include such uncertainties in their calculations. In the following we use different approaches for the calculation of the ‘probability to reject’ (frequentist, Bayesian and hybrid) for different clinical trial designs.\nDefinition ‘hybrid’ ([2], Section 6.5.2)\n‘[…] we have a prior distribution to use in our study design, but that the conclusions of the study will be entirely classical and will not make use of the prior […]’"
  },
  {
    "objectID": "01-NI.html#two-arm-non-inferiority-setting",
    "href": "01-NI.html#two-arm-non-inferiority-setting",
    "title": "2  Power and sample size calculations",
    "section": "2.2 Two-arm non-inferiority setting",
    "text": "2.2 Two-arm non-inferiority setting\nIn this section we consider a non-inferiority clinical trial setting with a null hypothesis \\(H_0: \\delta > \\delta^*\\) and alternative hypothesis \\(H_a: \\delta \\leq \\delta^*\\), where \\(\\delta^*>0\\) is a fixed non-inferiority margin and a treatment effect \\(\\delta\\), for example, a continuous difference or a risk difference.\n\n\n\n\n\n\n2.2.1 Binomial outcome\nHere \\(p_1\\) and \\(p_0\\) are event probabilities from an active treatment arm and a control arm, respectively. \\(\\delta=p_1-p_0\\) is the true treatment effect expressed as a risk difference.\nIn this section we assume that the variances in both groups are known, but might be different.\n\nWorking example\nWe use the SAFE-SSPE trial as a working example [3]. In brief, this non-inferiority randomised placebo-controlled trial compares clinical surveillance versus anticoagulant treatment in low-risk patients with isolated subsegmental pulmonary embolism (SSPE). The primary outcome is the proportion of 3-month recurrence of venous thromboembolism (VTE).\nThe null hypothesis \\(H_0\\) is ‘clinical surveillance is inferior to anticoagulant treatment’ versus the alternative hypothesis \\(H_a\\) ‘clinical surveillance is non-inferior to anticoagulant treatment’. Thus, \\(H_0: p_1-p_0>0\\) vs \\(H_a: p_1-p_0\\leq 0\\), where \\(p_1\\) is the VTE proportion in the clinical surveillance arm and \\(p_0\\) is the VTE proportion in the control arm.\nThe non-inferiority margin was set at 3.5% and it was assumed that the proportion of VTE in both groups was 1%.\n\n\n2.2.1.1 Frequentist approach\nLet \\(Y_{i,k} \\sim^{iid} Bernoulli(p_i)\\), \\(k=1,\\dots,n_i\\), \\(i\\in \\{0,1\\}\\). Let \\(\\overline p_i=\\frac{1}{n_i}\\sum_{k\\leq n_i} Y_{i,k}\\), \\(i\\in {0,1}\\), and thus the estimated risk difference \\(D=\\overline p_1-\\overline p_0\\) is asymptotically Gaussian distributed with \\(D \\sim N\\left(\\delta, \\frac{\\sigma_1^2}{n_1}+\\frac{\\sigma_0^2}{n_0}\\right)\\), where \\(\\sigma_i^2=p_i(1-p_i)\\), \\(i\\in \\{0,1\\}\\). For notational purposes we denote \\(\\sigma_{treat}^2=\\frac{\\sigma_1^2}{n_1}+\\frac{\\sigma_0^2}{n_0}\\), that is, the variance for the treatment effect.\nWe are interested whether the upper \\((1-\\alpha)\\%\\)-confidence limit is smaller than the non-inferiority margin, that is, \\[\nD+z_{1-\\alpha}\\sqrt{\\frac{n_0\\sigma_1^2+n_1\\sigma_0^2}{n_1n_0}}\\leq \\delta^*,\n\\] where \\(z_{1-\\alpha}=\\Phi^{-1}(1-\\alpha)\\). Simple algebra leads to \\[\nD\\leq -z_{1-\\alpha}\\sqrt{\\frac{n_0\\sigma_1^2+n_1\\sigma_0^2}{n_1n_0}}+\\delta^*.\n\\] Note that \\(D_{suc}^{\\delta^*}:=-z_{1-\\alpha}\\sqrt{\\frac{n_0\\sigma_1^2+n_1\\sigma_0^2}{n_1n_0}}+\\delta^*\\) is the required risk difference for a ‘successful’ rejection of the null hypothesis. Then \\[\n\\begin{aligned}\nP_\\delta(D\\leq D_{suc}^{\\delta^*})&=\\Phi\\left(-z_{1-\\alpha}-\\sqrt{\\frac{n_1n_0}{n_0\\sigma_1^2+n_1\\sigma_0^2}}(\\delta-\\delta^*)\\right) \\\\\n&=\\Phi\\left(-z_{1-\\alpha}-\\frac{(\\delta-\\delta^*)}{\\sigma_{treat}}\\right),\n\\end{aligned}\n\\] since under regularity conditions, \\[\nZ=\\frac{D-\\delta^*}{\\sigma_{treat}} \\rightarrow N(0,1), \\quad \\min(n_1,n_0) \\rightarrow \\infty.\n\\]\nThe conditional probability \\(P_{\\delta}(D\\leq D_{suc}^{\\delta^*})\\) is the probability to reject given \\(\\delta\\). For \\(\\delta>\\delta^*\\) this is the ‘type-I error’ and for \\(\\delta\\leq\\delta^*\\) this is the frequentist ‘power’.\nFor a \\(\\delta_A\\) it holds that\n\\[\n-z_{1-\\alpha}-\\sqrt{\\frac{n_1n_0}{n_0\\sigma_1^2+n_1\\sigma_0^2}}(\\delta_A-\\delta^*)=\\Phi^{-1}(1-\\beta)=z_{1-\\beta}\n\\] and so the sample size can then be derived as \\[\n\\frac{(z_{1-\\beta}+z_{1-\\alpha})^2}{(\\delta_A-\\delta^*)^2}=\\frac{an_0^2}{n_0\\sigma_1^2+an_0\\sigma_0^2},\n\\] where \\(a=n_1/n_0\\) is an allocation ratio, such that \\[\nn_0=(z_{1-\\beta}+z_{1-\\alpha})^2\\frac{\\sigma_1^2+a\\sigma_0^2}{a(\\delta_A-\\delta^*)^2}, \\quad n_1=an_0.\n\\]\n\\(\\delta_0\\), \\(\\delta_A\\) and \\(\\delta^*\\) are assumed as fixed and known constants in a frequentist approach. Their choices are of high importance, because all trial conclusions are based on those choices and affect the sample size calculation. The plot below shows how the sample size increase as \\(\\delta^*\\) approaches \\(\\delta\\).\n\n\n\n\n\n\nWorking example (continued)\nWe calculate the required sample size for the SAFE-SSPE trial using a frequentist approach with the following parameters:\n\n\\(p_1=0.01\\), \\(p_0=0.01\\), \\(\\delta^*=0.035\\), \\(1-\\beta=0.8\\), \\(\\alpha=0.05\\), \\(a=1/1\\)\n\n\n\nShow R code\nlibrary(epiR)\n\nalpha <- 0.05\nbeta <- 0.2\np_0 <- 0.01\np_1 <- 0.01\ndelta <- p_1 - p_0\ndelta_star <- 0.035\nsd_0 <- sqrt(p_0 * (1 - p_0))\nsd_1 <- sqrt(p_1 * (1 - p_1))\na <- 1/1\n\nepi.ssninfb(treat = p_1, control = p_0, delta = delta_star, power = 1 -\n    beta, r = a, alpha = alpha, n = NA)\n\n\n$n.total\n[1] 200\n\n$n.treat\n[1] 100\n\n$n.control\n[1] 100\n\n$delta\n[1] 0.035\n\n$power\n[1] 0.8\n\n\nShow R code\nn_0 <- ((qnorm(1 - beta) + qnorm(1 - alpha))^2) * ((sd_1^2 +\n    a * sd_0^2)/(a * (delta - delta_star)^2))\nn_0\n\n\n[1] 99.93031\n\n\nShow R code\nn_1 <- n_0 * a\nn_1\n\n\n[1] 99.93031\n\n\nUnder the specified parameters a sample size of 200 patients (100 per arm) is needed to reject the null hypothesis of inferiority. This is more or less the sample size mentioned in the study protocol of the SAFE-SSPE trial but without dropouts and adjustments for rare events.\n\n\n\n2.2.1.2 Hybrid approach: Prior on the treatment effect\nSuppose that the true treatment effect \\(\\delta\\) is a realization from a random variable \\(\\Delta\\) with \\(p(\\delta)\\). In this subsection we assume that the design prior comes from a Gaussian distribution function so that \\(\\Delta \\sim N\\left(d, \\frac{\\sigma_1^2+\\sigma_0^2}{m}\\right)\\). Note that this prior can be thought as a realisation from \\(m\\) Gaussian ‘prior observations’ with variance \\(\\sigma_1^2+\\sigma_0^2\\). Again for notational purposes we denote \\(\\sigma_{prior}^2=\\frac{\\sigma_1^2+\\sigma_0^2}{m}\\) as the variance of the design prior on the treatment effect.\nIn the following we will use the following design priors:\n\nEnthusiastic prior (favors non-inferiority): \\(d=0\\), \\(m=6.6\\), \\(P(\\Delta>\\delta^*)=0.05\\). This prior is centered on the treatment effect such that there is a low probability (here 5%) of inferiority.\nSkeptical prior (favors inferiority): \\(d=\\delta^*\\), \\(m=6.6\\), \\(P(\\Delta>0)=0.05\\). This prior is centered on the non-inferiority margin such that there is a low probability (here 5%) of superiority.\nInformative prior (clinical expert knowledge): \\(d=0\\) with \\(m=25\\).\nNoninformative prior: \\(d=0\\) with \\(m=0.5\\).\n\n\n\n\n\n\n\n\n\nLet \\[\nAP:=\\int_{\\Delta} P_{\\delta}(D\\leq D_{suc}^{\\delta^*})p(\\delta)d\\delta,\n\\]\nbe the ‘average power’ [4] (also called ‘assurance’ [5], ‘probability of success’ [1], [2] or Bayesian predictive power [6]. The supplemental section of [1] contains a literature review of the used terminology). Remember that in an hybrid approach we are interested in trial conclusions from a frequentist point of view, thus we are interested in\n\\[\nD\\leq -z_{1-\\alpha}\\sqrt{\\frac{n_0\\sigma_1^2+n_1\\sigma_0^2}{n_1n_0}}+\\delta^*.\n\\] By using a design prior we take into account the uncertainty of the treatment effect. The prior predictive distribution for an estimated risk difference, say \\(\\tilde D\\), with a prior \\(\\Delta \\sim N\\left(d, \\sigma_{prior}^2\\right)\\) includes this uncertainty. For the Gaussian case, the prior predictive distribution of \\(\\tilde D\\) is given as \\[\n\\tilde D \\sim N\\left(d, \\sigma_{treat}^2+\\sigma_{prior}^2\\right),\n\\] since \\(\\tilde D \\sim N\\left(\\delta, \\sigma_{treat}^2\\right)\\).\nSuppose now that \\(D\\) has a predictive distribution as described above, then \\[\n\\begin{aligned}\nAP&=\\int_{-\\infty}^{-z_{1-\\alpha}\\sqrt{\\frac{n_0\\sigma_1^2+n_1\\sigma_0^2}{n_1n_0}}+\\delta^*}f(\\tilde\\delta)d\\tilde\\delta= \\Phi\\left(\\frac{1}{\\sigma_{prior}}\\left[-z_{1-\\alpha}\\sigma_{treat}-(d-\\delta^*)\\right]\\right)\n\\end{aligned}\n\\] see for example [4]. Note that as \\(m \\rightarrow \\infty\\), then \\(AP \\rightarrow \\Phi\\left(-z_{1-\\alpha}-\\frac{(d-\\delta^*)}{\\sigma_{treat}}\\right)\\), that is, the frequentist power at \\(d\\).\n\nWorking example (continued)\nWe calculate the AP under the assumed prior distributions and parameters for the SAFE-SSPE trial.\n\n\nShow R code\n# Enthusiastic prior\nm <- 6.6\nprior_mean <- 0\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\n\nAP <- pnorm(1/sigma_prior * (-qnorm(1 - alpha) * sigma_treat -\n    (prior_mean - delta_star)))\n\ndata_output <- data.frame(type = \"Enthusiastic\", n_0, n_1, AP = round(AP,\n    2))\n\n# Skeptical prior\nm <- 6.6\nprior_mean <- delta_star\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\n\nAP <- pnorm(1/sigma_prior * (-qnorm(1 - alpha) * sigma_treat -\n    (prior_mean - delta_star)))\n\ndata_output <- rbind(data_output, data.frame(type = \"Skeptical\",\n    n_0, n_1, AP = round(AP, 2)))\n\n# Informative prior\nm <- 25\nprior_mean <- 0\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\n\nAP <- pnorm(1/sigma_prior * (-qnorm(1 - alpha) * sigma_treat -\n    (prior_mean - delta_star)))\n\ndata_output <- rbind(data_output, data.frame(type = \"Informative\",\n    n_0, n_1, AP = round(AP, 2)))\n\n# Noninformative prior\nm <- 0.5\nprior_mean <- 0\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\n\nAP <- pnorm(1/sigma_prior * (-qnorm(1 - alpha) * sigma_treat -\n    (prior_mean - delta_star)))\n\ndata_output <- rbind(data_output, data.frame(type = \"Noninformative\",\n    n_0, n_1, AP = round(AP, 2)))\n\ndata.frame(data_output %>%\n    arrange(type))\n\n\n            type      n_0      n_1   AP\n1   Enthusiastic 99.93031 99.93031 0.59\n2    Informative 99.93031 99.93031 0.66\n3 Noninformative 99.93031 99.93031 0.52\n4      Skeptical 99.93031 99.93031 0.34\n\n\nUnder an ‘enthusiastic prior’ we get an average power of 59%. For an ‘skeptical prior’ the average power decreases to 34%. These values are lower than the frequentist power of 80%.\n\nRufibach et al. give a closed a formula for the distribution of \\(RPR:=P_\\Delta(D\\leq D_{suc}^{\\delta^*})\\), where \\(\\Delta \\sim N(d,\\sigma^2_{prior})\\), and discuss the shape under different prior choices [6]. In the following we use the wording ’random probability to reject` (RPR) similar to [1].\nFor \\(0<y<1\\), the random variable \\(RPR\\) has a probability density function \\[\n\\begin{aligned}\nf(y)&=\\frac{\\sigma_{treat}}{\\sigma_{prior}} \\phi\\left(-z_{1-\\alpha}\\frac{\\sigma_{treat}}{\\sigma_{prior}}-\\frac{(d-\\delta^*)}{\\sigma_{prior}}-\\frac{\\sigma_{treat}}{\\sigma_{prior}}\\Phi^{-1}(y) \\right)\\left[ \\phi\\left(\\Phi^{-1}(y) \\right) \\right]^{-1},\n\\end{aligned}\n\\] see [6].\n\nSpecial case\nFor the case that \\(n_0=n_1=n\\) and \\(\\sigma_1^2=\\sigma_0^2=\\sigma^2\\), then \\(\\sigma_{treat}^2=\\frac{2\\sigma^2}{n}\\) and \\(\\sigma_{prior}^2=\\frac{2\\sigma^2}{m}\\), and the formula above reduces to\n\\[\n\\begin{aligned}\nf(y)&=\\sqrt{\\frac{m}{n}}\\phi\\left(\\sqrt{\\frac{m}{n}}\\left[-z_{1-\\alpha}-\\sqrt{\\frac{n}{2\\sigma^2}}(d-\\delta^*)-\\Phi^{-1}(y)\\right] \\right)\\left[ \\phi\\left(\\Phi^{-1}(y) \\right) \\right]^{-1}, \\quad 0<y<1.\n\\end{aligned}\n\\]\n\n\nWorking example (continued)\nWe derive the probability densities for the different assumed design priors for the SAFE-SSPE study.\n\n\nShow R code\nx <- seq(0.001, 0.999, 0.001)\n\n# Enthusiastic prior\nm <- 6.6\nprior_mean <- 0\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\n\n## Rufibach 2016: formula (4)\ny <- sqrt(m * n_0 * sd_1^2 + m * n_1 * sd_0^2)/(sqrt(n_1 * n_0 *\n    (sd_0^2 + sd_1^2))) * dnorm(-sqrt(m * n_0 * sd_1^2 + m *\n    n_1 * sd_0^2)/(sqrt(n_1 * n_0 * (sd_0^2 + sd_1^2))) * qnorm(1 -\n    alpha) - sqrt(m)/sqrt((sd_0^2 + sd_1^2)) * (prior_mean -\n    delta_star) - sqrt(m * n_0 * sd_1^2 + m * n_1 * sd_0^2)/(sqrt(n_1 *\n    n_0 * (sd_0^2 + sd_1^2))) * qnorm(x)) * (dnorm(qnorm(x)))^(-1)\n\ndata_power <- data.frame(x, y, type = \"Enthusiastic\")\n\n# Skeptical prior\nm <- 6.6\nprior_mean <- delta_star\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\n\ny <- sigma_treat/sigma_prior * dnorm(-qnorm(1 - alpha) * sigma_treat/sigma_prior -\n    (1/sigma_prior) * (prior_mean - delta_star) - (sigma_treat/sigma_prior) *\n    qnorm(x)) * (dnorm(qnorm(x)))^(-1)\n\ndata_power <- rbind(data_power, data.frame(x, y, type = \"Skeptical\"))\n\n# Informative prior\nm <- 25\nprior_mean <- 0\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\n\ny <- sigma_treat/sigma_prior * dnorm(-qnorm(1 - alpha) * sigma_treat/sigma_prior -\n    (1/sigma_prior) * (prior_mean - delta_star) - (sigma_treat/sigma_prior) *\n    qnorm(x)) * (dnorm(qnorm(x)))^(-1)\n\ndata_power <- rbind(data_power, data.frame(x, y, type = \"Informative\"))\n\n# Noninformative prior\nm <- 0.5\nprior_mean <- 0\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\n\ny <- sigma_treat/sigma_prior * dnorm(-qnorm(1 - alpha) * sigma_treat/sigma_prior -\n    (1/sigma_prior) * (prior_mean - delta_star) - (sigma_treat/sigma_prior) *\n    qnorm(x)) * (dnorm(qnorm(x)))^(-1)\n\ndata_power <- rbind(data_power, data.frame(x, y, type = \"Noninformative\"))\n\ndata_output2 <- data_output %>%\n    select(type, x = AP) %>%\n    mutate(y = 0)\n\ndata_power$type <- factor(data_power$type, levels = c(\"Enthusiastic\",\n    \"Skeptical\", \"Informative\", \"Noninformative\"))\n\nggplot(data_power, aes(x, y, colour = type)) + geom_line(linewidth = 1) +\n    geom_point(data = data_output2, aes(x = x, y = y, colour = type)) +\n    scale_colour_manual(\"Prior type\", values = c(\"purple\", \"orange\",\n        \"blue\", \"darkred\")) + theme_bw() + theme(panel.grid = element_blank()) +\n    ylab(\"Density\") + xlab(\"RPR\") + ylim(c(0, 2)) + labs(caption = \"Dots indicate the AP.\")\n\n\n\n\n\n\nThe cumulative distribution function of \\(RPR\\) can the be calculated as\n\\[\n\\begin{aligned}\nP(RPR\\leq y)=1-\\Phi&\\left(\\frac{\\sigma_{treat}}{\\sigma_{prior}}\\left[-z_{1-\\alpha}-\\frac{(d-\\delta^*)}{\\sigma_{treat}}-\\Phi^{-1}(y) \\right]\\right), \\quad 0<y<1.\n\\end{aligned}\n\\]\n\nSpecial case\nFor the case that \\(n_0=n_1=n\\) and \\(\\sigma_1^2=\\sigma_0^2=\\sigma^2\\), then \\(\\sigma_{treat}^2=\\frac{2\\sigma^2}{n}\\) and \\(\\sigma_{prior}^2=\\frac{2\\sigma^2}{m}\\), and the formula above reduces to\n\\[\n\\begin{aligned}\nP(RPR\\leq y)=1-\\Phi&\\left(\\frac{\\sigma_{treat}}{\\sigma_{prior}}\\left[-z_{1-\\alpha}-\\frac{(d-\\delta^*)}{\\sigma_{treat}}-\\Phi^{-1}(y) \\right] \\right), \\quad 0<y<1.\n\\end{aligned}\n\\]\n\nNote that if \\(n_0\\) and \\(n_1\\) are the planned treatment arm sample sizes from a frequentist power calculation as described in Section 2.1.1 above, then, if \\(d=\\delta_A\\), \\[\n-z_{1-\\alpha}-\\frac{(d-\\delta^*)}{\\sigma_{treat}}=\\Phi^{-1}(y)=\\Phi^{-1}(1-\\beta) \\quad \\Rightarrow \\quad P(RPR\\leq y)=0.5, \\quad y=1-\\beta.\n\\]\n\nWorking example (continued)\nWith the above formula we calculate the probability \\(P(RPR>\\gamma)\\), \\(0<\\gamma<1\\), for the SAFE-SSPE study. We use an enthusiastic (\\(m=6.6\\)), an informative (\\(m=25\\)) and a noninformative prior (\\(m=0.5\\)) prior, all centered on \\(\\delta=0\\).\n\n\nShow R code\n# gamma range\ngamma <- seq(0.01, 0.99, 0.01)\n\n# Centered on p1-p0\nprior_mean <- 0\nm_range <- c(0.5, 6.6, 25)\nn_0_range <- n_0\ndata_rpr <- expand.grid(gamma, m_range, n_0_range)\nnames(data_rpr) <- c(\"gamma\", \"m_range\", \"n_0_range\")\ndata_rpr$n_1_range <- a * data_rpr$n_0_range\ndata_rpr$sigma_treat <- sqrt(sd_0^2/data_rpr$n_0_range + sd_1^2/data_rpr$n_1_range)\ndata_rpr$sigma_prior <- sqrt(sd_0^2/data_rpr$m_range + sd_1^2/data_rpr$m_range)\n\ndata_rpr$p_rpr <- pnorm(-qnorm(1 - alpha) * data_rpr$sigma_treat/data_rpr$sigma_prior -\n    (1/data_rpr$sigma_prior) * (prior_mean - delta_star) - \n      (data_rpr$sigma_treat/data_rpr$sigma_prior) *\n    qnorm(data_rpr$gamma))\n\ndata_rpr$type <- NA\ndata_rpr$type[data_rpr$m_range == 0.5] <- \"Noninformative\"\ndata_rpr$type[data_rpr$m_range == 6.6] <- \"Enthusiastic\"\ndata_rpr$type[data_rpr$m_range == 25] <- \"Informative\"\n\n# Centered on noninferiority margin\nprior_mean <- delta_star\nm_range <- c(6.6)\nn_0_range <- n_0\ndata_rpr_skep <- expand.grid(gamma, m_range, n_0_range)\nnames(data_rpr_skep) <- c(\"gamma\", \"m_range\", \"n_0_range\")\ndata_rpr_skep$n_1_range <- a * data_rpr_skep$n_0_range\ndata_rpr_skep$sigma_treat <- sqrt(sd_0^2/data_rpr_skep$n_0_range +\n    sd_1^2/data_rpr_skep$n_1_range)\ndata_rpr_skep$sigma_prior <- sqrt(sd_0^2/data_rpr_skep$m_range +\n    sd_1^2/data_rpr_skep$m_range)\n\ndata_rpr_skep$p_rpr <- pnorm(-qnorm(1 - alpha) * \n                               data_rpr_skep$sigma_treat/data_rpr_skep$sigma_prior -\n    (1/data_rpr_skep$sigma_prior) * (prior_mean - delta_star) -\n    (data_rpr_skep$sigma_treat/data_rpr_skep$sigma_prior) * qnorm(data_rpr_skep$gamma))\n\ndata_rpr_skep$type <- \"Skeptical\"\n\ndata_rpr <- rbind(data_rpr, data_rpr_skep)\n\ndata_rpr$type <- factor(data_rpr$type, levels = c(\"Enthusiastic\",\n    \"Skeptical\", \"Informative\", \"Noninformative\"))\n\nggplot(data_rpr, aes(x = gamma, y = p_rpr, colour = type)) +\n    geom_line(linewidth = 1) + theme_bw() + theme(panel.grid.minor = element_blank()) +\n    scale_colour_manual(\"Prior type\", values = c(\"purple\", \"orange\",\n        \"blue\", \"darkred\")) + scale_y_continuous(breaks = seq(0,\n    1, 0.1)) + scale_x_continuous(breaks = seq(0, 1, 0.2)) +\n    labs(caption = str_glue(\"Calculated based on a planned total sample size of \",\n        round(n_0_range + a * n_0_range, 0), \".\")) + xlab(\"Threshold gamma\") +\n    ylab(\"Probability that RPR is greater than threshold gamma\")\n\n\n\n\n\nFor a specific threshold, say \\(\\gamma=0.6\\), and varying ‘prior sample sizes’ \\(m\\) we obtain\n\n\nShow R code\ngamma <- 0.6\n\n# Centered on p1-p0\nprior_mean <- 0\n\nm_range <- c(0.5, 6.6, 25)\nn_0_range <- seq(0.01, 300, by = 1)\n\ndata_rpr <- expand.grid(m_range, n_0_range)\nnames(data_rpr) <- c(\"m_range\", \"n_0_range\")\ndata_rpr$n_1_range <- a * data_rpr$n_0_range\ndata_rpr$sigma_treat <- sqrt(sd_0^2/data_rpr$n_0_range + sd_1^2/data_rpr$n_1_range)\ndata_rpr$sigma_prior <- sqrt(sd_0^2/data_rpr$m_range + sd_1^2/data_rpr$m_range)\n\ndata_rpr$p_rpr <- pnorm(data_rpr$sigma_treat/data_rpr$sigma_prior *\n    (-qnorm(1 - alpha) - (1/data_rpr$sigma_treat) * (prior_mean -\n        delta_star) - qnorm(gamma)))\n\ndata_rpr$type <- NA\ndata_rpr$type[data_rpr$m_range == 0.5] <- \"Noninformative\"\ndata_rpr$type[data_rpr$m_range == 6.6] <- \"Enthusiastic\"\ndata_rpr$type[data_rpr$m_range == 25] <- \"Informative\"\n\n\n# Centered on noninferiority margin\nprior_mean <- delta_star\nm_range <- c(6.6)\nn_0_range <- seq(0.01, 300, by = 1)\n\ndata_rpr_skep <- expand.grid(m_range, n_0_range)\nnames(data_rpr_skep) <- c(\"m_range\", \"n_0_range\")\ndata_rpr_skep$n_1_range <- a * data_rpr_skep$n_0_range\ndata_rpr_skep$sigma_treat <- sqrt(sd_0^2/data_rpr_skep$n_0_range +\n    sd_1^2/data_rpr_skep$n_1_range)\ndata_rpr_skep$sigma_prior <- sqrt(sd_0^2/data_rpr_skep$m_range +\n    sd_1^2/data_rpr_skep$m_range)\n\ndata_rpr_skep$p_rpr <- pnorm(data_rpr_skep$sigma_treat/data_rpr_skep$sigma_prior *\n    (-qnorm(1 - alpha) - (1/data_rpr_skep$sigma_treat) * (prior_mean -\n        delta_star) - qnorm(gamma)))\n\ndata_rpr_skep$type <- \"Skeptical\"\n\ndata_rpr <- rbind(data_rpr, data_rpr_skep)\n\ndata_rpr$type <- factor(data_rpr$type, levels = c(\"Enthusiastic\",\n    \"Skeptical\", \"Informative\", \"Noninformative\"))\n\nggplot(data_rpr, aes(x = n_1_range + n_0_range, y = p_rpr, colour = type)) +\n    geom_line(linewidth = 1) + theme_bw() + theme(panel.grid.minor = element_blank()) +\n    scale_colour_manual(\"Prior type\", values = c(\"purple\", \"orange\",\n        \"blue\", \"darkred\")) + xlab(\"Planned total sample size\") +\n    ylab(str_glue(\"Probability that RPR is greater than \", gamma *\n        100, \"%\")) + scale_x_continuous(breaks = c(0, 100, 200,\n    300, 400), limits = c(0, 400)) + geom_vline(xintercept = 200,\n    linetype = \"dashed\") + scale_y_continuous(breaks = seq(0,\n    1, 0.1))\n\n\n\n\n\n\nNote that the average power AP integrates over the whole \\(\\Delta\\) range. This might include also ‘non-favorable’ regions. To see that one can decompose AP as follows (see [1], [4]): \\[\nAP=\\overbrace{P(D\\leq D_{suc}^{\\delta^*}, \\Delta>\\delta^*)}^{(1)}+\\overbrace{P(D\\leq D_{suc}^{\\delta^*}, 0<\\Delta\\leq\\delta^*)}^{(2)}+\\overbrace{P(D\\leq D_{suc}^{\\delta^*}, \\Delta\\leq0)}^{(3)}\n\\] where\n\n\\((1)\\) Probability of Type-I error,\n\\((2)\\) ‘Non-inferior, but treatment effect not relevant’,\n\\((3)\\) ‘Non-inferior, treatment effect relevant’.\n\nSpiegelhalter et al. highlights that \\(AP \\approx P(D\\leq D_{suc}^{\\delta^*}, \\Delta\\leq0)\\) because the type-I error is often small and one has strong believe for the alternative hypothesis [2]. [1] and [5] discuss the relevance of the AP decomposition. For example, pharmaceutical companies might (1)+(2)+(3) taking into account shortterm risk, wheras regulators are interested in (1) or (1)+(2), that is non-inferior outcomes with relevant treatment effects.\nFor the non-inferiority setting we are interested in (2)+(3), that is \\(\\Delta\\leq\\delta^*\\):\n\\[\nP(D\\leq D_{suc}^{\\delta^*}, \\Delta\\leq\\delta^*)=P(D\\leq D_{suc}^{\\delta^*}|\\Delta\\leq\\delta^*)P(\\Delta\\leq\\delta^*)=\\underbrace{E\\left[P_{\\Delta\\leq\\delta^*}(D\\leq D_{suc}^{\\delta^*})\\right]}_{EP}P(\\Delta\\leq\\delta^*),\n\\] Kunzmann et al. denote EP the ‘expected power’ [1]. Note that\n\\[\n\\underbrace{P(D\\leq D_{suc}^{\\delta^*}, \\Delta\\leq\\delta^*)}_{PAP}=\\underbrace{E\\left[P_{\\Delta\\leq\\delta^*}(D\\leq D_{suc}^{\\delta^*})\\right]}_{EP}\\underbrace{P(\\Delta\\leq\\delta^*)}_{constant}.\n\\] Spiegelhalter calls \\(P(D\\leq D_{suc}^{\\delta^*}, \\Delta\\leq\\delta^*)\\) the ‘prior adjusted power’ (PAP).\nThe AP decomposition can be visualised using the posterior predictive distribution. Let \\(p(\\tilde\\delta)\\) be the pdf of the posterior predictive distribution then \\[\np(\\tilde\\delta, \\delta)= N_2\\left(\\begin{pmatrix} d \\\\ d \\end{pmatrix}, \\begin{pmatrix} \\sigma^2_{treat}+\\sigma^2_{prior} \\quad \\sigma^2_{prior} \\\\ \\quad \\quad \\sigma^2_{prior} \\quad \\ \\quad  \\sigma^2_{prior}\\end{pmatrix}\\right),\n\\] see formula (2.11) in [4].\n\nWorking example (continued)\nFor the SAFE-SSPE study the bivariate scatterplot of \\(p(\\tilde\\delta, \\delta)\\) under an enthusiastic prior can be visualised as:\n\n\nShow R code\nlibrary(mvtnorm)\nlibrary(tidyverse)\nlibrary(ggplot2)\n\ndelta_star <- 0.035\nprior_mean <- 0\nm <- 6.6\n\nsigma_sim <- matrix(c((sd_0^2/n_0 + sd_1^2/n_1 + (sd_1^2 + sd_0^2)/m),\n    (sd_1^2 + sd_0^2)/m, (sd_1^2 + sd_0^2)/m, (sd_1^2 + sd_0^2)/m),\n    nrow = 2, ncol = 2, byrow = T)\n\nset.seed(1)\ndata_sim <- data.frame(rmvnorm(n = 10000, mean = c(prior_mean,\n    prior_mean), sigma_sim))\nnames(data_sim) <- c(\"delta_pred\", \"delta\")\n\ndata_sim$region <- ifelse(data_sim$delta <= 0 & data_sim$delta_pred <=\n    -qnorm(1 - alpha) * sqrt(sd_1^2/n_1+sd_0^2/n_0) - (prior_mean - delta_star),\n    1, 0)\ndata_sim$region <- ifelse(data_sim$delta > 0 & data_sim$delta <=\n    delta_star & data_sim$delta_pred <= -qnorm(1 - alpha) * sqrt(sd_1^2/n_1+sd_0^2/n_0) -\n    (prior_mean - delta_star), 2, data_sim$region)\ndata_sim$region <- ifelse(data_sim$delta > delta_star & data_sim$delta_pred <=\n    -qnorm(1 - alpha) * sqrt(sd_1^2/n_1+sd_0^2/n_0) - (prior_mean - delta_star),\n    3, data_sim$region)\n\ndata_sim$region <- factor(data_sim$region, levels = 0:3, labels = c(\"'Not significant'\",\n    \"(3)\", \"(2)\", \"(1)\"))\n\nggplot(data_sim, aes(x = delta, y = delta_pred, colour = factor(region))) +\n    geom_point(size = 0.3) + theme_bw() + theme(panel.grid.minor = element_blank()) +\n    geom_vline(xintercept = 0.035, linetype = \"dashed\") + geom_hline(yintercept = -qnorm(1 -\n    alpha) * sqrt(sd_1^2/n_1+sd_0^2/n_0) - (prior_mean - delta_star), linetype = \"dotted\") +\n    ylab(\"Predictive distribution of Delta\") + xlab(\"Delta\") +\n    scale_color_brewer(\"Region\", palette = \"Reds\") + scale_x_continuous(breaks = c(-0.2,\n    -0.1, 0, 0.035, 0.2), labels = c(-0.2, -0.1, 0, 0.035, 0.2)) +\n    labs(caption = \"Dashed line: Noninferiority margin.\\nDotted line: Upper CI from predicted delta <= non-inferiority margin.\")\n\n\n\n\n\nShow R code\ndata_output <- data.frame(data_sim %>%\n    group_by(region) %>%\n    summarise(prop = n()/nrow(data_sim)))\n\ndata_output\n\n\n             region   prop\n1 'Not significant' 0.4148\n2               (3) 0.4909\n3               (2) 0.0920\n4               (1) 0.0023\n\n\nFrom the above values the average power can be calculated as (1) 0.0023 + (2) 0.092 + (3) 0.4909, which is equal to 0.5852. This is the value we reported above (59%).\nThe results of EP, PAP and AP are shown in the table below:\n\n\nShow R code\ndelta_star <- 0.035\nprior_mean <- 0\nm <- 6.6\n\nset.seed(1)\n\nsd_prior <- sqrt((sd_1^2 + sd_0^2))/sqrt(m)\ndraws <- rnorm(10000, mean = prior_mean, sd = sd_prior)\n\npower_classic <- pnorm(-qnorm(1 - alpha) - sqrt(n_0 * n_1)/sqrt((n_0 *\n    sd_1^2 + n_1 * sd_0^2)) * (draws - delta_star))\n\ndata_ep <- data.frame(ep = mean(power_classic[draws <= delta_star]),\n    pap = mean(power_classic[draws <= delta_star]) * pnorm(delta_star,\n        mean = prior_mean, sd = sd_prior), ap = mean(power_classic),\n    const = pnorm(delta_star, mean = prior_mean, sd = sd_prior),\n    type = \"Skeptical\")\n\nset.seed(1)\nprior_mean <- delta_star\nm <- 6.6\ndraws <- rnorm(10000, mean = prior_mean, sd = sd_prior)\n\npower_classic <- pnorm(-qnorm(1 - alpha) - sqrt(n_0 * n_1)/sqrt((n_0 *\n    sd_1^2 + n_1 * sd_0^2)) * (draws - delta_star))\n\ndata_ep <- rbind(data_ep, data.frame(ep = mean(power_classic[draws <=\n    delta_star]), pap = mean(power_classic[draws <= delta_star]) *\n    pnorm(delta_star, mean = prior_mean, sd = sd_prior), ap = mean(power_classic),\n    const = pnorm(delta_star, mean = prior_mean, sd = sd_prior),\n    type = \"Enthusiastic\"))\n\n\nprior_mean <- 0\nm <- 25\nset.seed(1)\ndraws <- rnorm(10000, mean = prior_mean, sd = sd_prior)\n\npower_classic <- pnorm(-qnorm(1 - alpha) - sqrt(n_0 * n_1)/sqrt((n_0 *\n    sd_1^2 + n_1 * sd_0^2)) * (draws - delta_star))\n\ndata_ep <- rbind(data_ep, data.frame(ep = mean(power_classic[draws <=\n    delta_star]), pap = mean(power_classic[draws <= delta_star]) *\n    pnorm(delta_star, mean = prior_mean, sd = sd_prior), ap = mean(power_classic),\n    const = pnorm(delta_star, mean = prior_mean, sd = sd_prior),\n    type = \"Informative\"))\n\nprior_mean <- 0\nm <- 0.5\nset.seed(1)\ndraws <- rnorm(1e+05, mean = prior_mean, sd = sd_tilde/sqrt(0.5))\n\npower_classic <- pnorm(-qnorm(1 - alpha) - sqrt(n_0 * n_1)/sqrt((n_0 *\n    sd_1^2 + n_1 * sd_0^2)) * (draws - delta_star))\n\ndata_ep <- rbind(data_ep, data.frame(ep = mean(power_classic[draws <=\n    delta_star]), pap = mean(power_classic[draws <= delta_star]) *\n    pnorm(delta_star, mean = prior_mean, sd = sd_prior), ap = mean(power_classic),\n    const = pnorm(delta_star, mean = prior_mean, sd = sd_prior),\n    type = \"Noninformative\"))\n\n\ndata_ep$ep <- round(data_ep$ep, 4)\ndata_ep$ap <- round(data_ep$ap, 4)\ndata_ep$pap <- round(data_ep$pap, 4)\ndata_ep$const <- round(data_ep$const, 4)\n\ndata_ep\n\n\n      ep    pap     ap  const           type\n1 0.7930 0.5857 0.5872 0.7386      Skeptical\n2 0.6740 0.3370 0.3437 0.5000   Enthusiastic\n3 0.7930 0.5857 0.5872 0.7386    Informative\n4 0.9186 0.6785 0.5233 0.7386 Noninformative\n\n\n\n\n\n2.2.1.3 Proper Bayesian approach: Prior on the treatment effect\nA proper Bayesian approach uses the posterior distribution to define ‘a successful trial result’. Remember that \\(D=\\overline{p}_1-\\overline{p}_0\\) with \\(D \\sim N(\\delta, \\sigma^2_{treat})\\). Suppose that \\(\\Delta \\sim N(d, \\sigma^2_{prior})\\) is an analysis prior, then the posterior distribution is given as \\[\n\\begin{aligned}\n\\Delta|D \\sim N\\left(\\frac{\\frac{d}{\\sigma^2_{prior}}+\\frac{D}{\\sigma^2_{treat}}}{\\frac{1}{\\sigma^2_{prior}}+\\frac{1}{\\sigma^2_{treat}}}, \\frac{1}{\\frac{1}{\\sigma^2_{prior}}+\\frac{1}{\\sigma^2_{treat}}}\\right)=N\\left( \\frac{\\sigma^2_{treat}d+\\sigma^2_{prior}D}{\\sigma^2_{treat}+\\sigma^2_{prior}}, \\frac{\\sigma^2_{treat}\\sigma^2_{prior}}{\\sigma^2_{treat}+\\sigma^2_{prior}}  \\right),\n\\end{aligned}\n\\] see for example [7].\n\nSpecial case\nIf \\(n_0=n_1=n\\) and \\(\\sigma_1^2=\\sigma_0^2=\\sigma^2\\), then \\(\\sigma_{treat}^2=\\frac{2\\sigma^2}{n}\\) and \\(\\sigma_{prior}^2=\\frac{2\\sigma^2}{m}\\), and the formula above reduces to\n\\[\n\\Delta|D \\sim N\\left(\\frac{m\\delta+nD}{n+m}, \\frac{2\\sigma^2}{n+m} \\right).\n\\]\n\nA trial success can then be defined as \\[\nP(\\Delta\\leq\\delta^*|D)=1-\\epsilon,\n\\] where \\(\\epsilon\\) is small, say \\(\\epsilon=0.05\\).\nSimilar to the frequentist approach, one is interested whether the upper \\((1-\\epsilon)\\) credible interval is smaller than the non-inferiority margin, that is\n\\[\n\\frac{\\sigma^2_{treat}d+\\sigma^2_{prior}D}{\\sigma^2_{treat}+\\sigma^2_{prior}}+z_{1-\\epsilon}\\frac{\\sigma_{treat}\\sigma_{prior}}{\\sqrt{\\sigma^2_{treat}+\\sigma^2_{prior}}}\\leq \\delta^*.\n\\] A simple algebraic step gives\n\\[\n\\begin{aligned}\nD\\leq -z_{1-\\epsilon}&\\frac{\\sigma_{treat}}{\\sigma_{prior}}\\sqrt{\\sigma^2_{treat}+\\sigma^2_{prior}}+\\delta^*\\left(1+\\frac{\\sigma_{treat}^2}{\\sigma_{prior}^2}\\right)-\\frac{\\sigma^2_{treat}}{\\sigma^2_{prior}}d.\n\\end{aligned}\n\\] Similar to the frequentist approach we can denote \\(D_{suc}^{d,\\delta^*}=-z_{1-\\epsilon}\\frac{\\sigma_{treat}}{\\sigma_{prior}}\\sqrt{\\sigma^2_{treat}+\\sigma^2_{prior}}+\\delta^*\\left(1+\\frac{\\sigma_{treat}^2}{\\sigma_{prior}^2}\\right)-\\frac{\\sigma^2_{treat}}{\\sigma^2_{prior}}d\\) as the required risk difference for a successful rejection of the null hypothesis in the Bayesian setting.\nThus, since \\(D\\sim N(\\delta, \\sigma_{treat}^2)\\), \\[\n\\begin{aligned}\nP(D\\leq D_{suc}^{d,\\delta^*}|\\delta)&=\\Phi\\left(-z_{1-\\epsilon}\\sqrt{1+\\frac{\\sigma^2_{treat}}{\\sigma_{prior}^2}}-\\frac{1}{\\sigma_{treat}}\\left[\\delta-\\delta^*\\left\\{ 1+\\frac{\\sigma_{treat}^2}{\\sigma_{prior}^2} \\right\\} \\right]-\\frac{\\sigma_{treat}}{\\sigma_{prior}^2}d \\right).\n\\end{aligned}\n\\] This is the Bayesian probability to reject (or Bayesian power) under an (assumed) known true treatment effect \\(\\delta\\). Note that this is a conditional probability on \\(\\delta\\).\n\nSpecial case\nIf \\(n_0=n_1=n\\) and \\(\\sigma_1^2=\\sigma_0^2=\\sigma^2\\), then \\(\\sigma_{treat}^2=\\frac{2\\sigma^2}{n}\\) and \\(\\sigma_{prior}^2=\\frac{2\\sigma^2}{m}\\), and the formula above reduces to \\[\n\\begin{aligned}\nP(D\\leq D_{suc}^{d,\\delta^*}|\\delta)&=\\Phi\\left(-z_{1-\\epsilon}\\sqrt{\\frac{n+m}{n}}- \\frac{m}{\\sqrt{2n\\sigma^2}}d-\\sqrt{\\frac{n}{2n\\sigma^2}}\\left\\{\\delta-\\delta^*\\left(\\frac{n+m}{n} \\right)\\right\\} \\right).\n\\end{aligned}\n\\]\n\n\nWorking example (continued)\nWe derive the Bayesian probability to reject for the SAFE-SSPE study for different \\(\\delta\\) values and analysis priors.\n\n\nShow R code\n# Delta range\ndelta <- seq(-0.025, 0.05, 0.001)\n\n# Epsilon\nepsilon <- 0.05\n\n# Enthusiastic prior\nprior_mean <- 0\nm <- 6.6\n\nap_bayes <- pnorm(-qnorm(1 - epsilon) * (sqrt(1 + m * (n_0 *\n    sd_1^2 + n_1 * sd_0^2)/(n_1 * n_0 * (sd_1^2 + sd_0^2)))) -\n    (m * sqrt(n_0 * sd_1^2 + n_1 * sd_0^2))/(sqrt(n_1 * n_0) *\n        (sd_1^2 + sd_0^2)) * prior_mean - sqrt((n_1 * n_0)/((n_0 *\n    sd_1^2 + n_1 * sd_0^2))) * (delta - delta_star * (1 + (m *\n    (n_0 * sd_1^2 + n_1 * sd_0^2))/(n_1 * n_0 * (sd_1^2 + sd_0^2)))))\n\ndata_power <- data.frame(delta, y = ap_bayes, type = \"Bayes: Enthusiastic\")\n\n# Skeptical prior\nprior_mean <- 0.035\nm <- 6.6\n\nap_bayes <- pnorm(-qnorm(1 - epsilon) * (sqrt(1 + m * (n_0 *\n    sd_1^2 + n_1 * sd_0^2)/(n_1 * n_0 * (sd_1^2 + sd_0^2)))) -\n    (m * sqrt(n_0 * sd_1^2 + n_1 * sd_0^2))/(sqrt(n_1 * n_0) *\n        (sd_1^2 + sd_0^2)) * prior_mean - sqrt((n_1 * n_0)/((n_0 *\n    sd_1^2 + n_1 * sd_0^2))) * (delta - delta_star * (1 + (m *\n    (n_0 * sd_1^2 + n_1 * sd_0^2))/(n_1 * n_0 * (sd_1^2 + sd_0^2)))))\n\ndata_power <- rbind(data_power, data.frame(delta, y = ap_bayes,\n    type = \"Bayes: Skeptical\"))\n\n# Informative prior\nprior_mean <- 0\nm <- 25\n\nap_bayes <- pnorm(-qnorm(1 - epsilon) * (sqrt(1 + m * (n_0 *\n    sd_1^2 + n_1 * sd_0^2)/(n_1 * n_0 * (sd_1^2 + sd_0^2)))) -\n    (m * sqrt(n_0 * sd_1^2 + n_1 * sd_0^2))/(sqrt(n_1 * n_0) *\n        (sd_1^2 + sd_0^2)) * prior_mean - sqrt((n_1 * n_0)/((n_0 *\n    sd_1^2 + n_1 * sd_0^2))) * (delta - delta_star * (1 + (m *\n    (n_0 * sd_1^2 + n_1 * sd_0^2))/(n_1 * n_0 * (sd_1^2 + sd_0^2)))))\n\ndata_power <- rbind(data_power, data.frame(delta, y = ap_bayes,\n    type = \"Bayes: Informative\"))\n\n# Noninformative prior\nprior_mean <- 0\nm <- 0.5\n\nap_bayes <- pnorm(-qnorm(1 - epsilon) * (sqrt(1 + m * (n_0 *\n    sd_1^2 + n_1 * sd_0^2)/(n_1 * n_0 * (sd_1^2 + sd_0^2)))) -\n    (m * sqrt(n_0 * sd_1^2 + n_1 * sd_0^2))/(sqrt(n_1 * n_0) *\n        (sd_1^2 + sd_0^2)) * prior_mean - sqrt((n_1 * n_0)/((n_0 *\n    sd_1^2 + n_1 * sd_0^2))) * (delta - delta_star * (1 + (m *\n    (n_0 * sd_1^2 + n_1 * sd_0^2))/(n_1 * n_0 * (sd_1^2 + sd_0^2)))))\n\ndata_power <- rbind(data_power, data.frame(delta, y = ap_bayes,\n    type = \"Bayes: Noninformative\"))\n\n# Frequentist\ny_freq <- pnorm(-(delta - delta_star) * sqrt(n_1 * n_0)/sqrt(n_0 *\n    sd_1^2 + n_1 * sd_0^2) - qnorm(1 - alpha))\ndata_power <- rbind(data_power, data.frame(delta, y = y_freq,\n    type = \"Frequentist\"))\n\ndata_power$type <- factor(data_power$type, levels = c(\"Bayes: Enthusiastic\",\n    \"Bayes: Skeptical\", \"Bayes: Informative\", \"Bayes: Noninformative\",\n    \"Frequentist\"))\n\n\nggplot(data_power, aes(x = delta, y = y, colour = type)) + geom_line() +\n    theme_bw() + theme(panel.grid.minor = element_blank()) +\n    scale_colour_manual(\"Type\", values = c(\"purple\", \"orange\",\n        \"blue\", \"darkred\", \"green\")) + ylab(\"Probability to reject\") +\n    ylab(\"Probability to reject\") + scale_x_continuous(breaks = c(-0.025,\n    0, 0.035, 0.05)) + scale_y_continuous(breaks = c(0, 0.5,\n    0.8, 1)) + geom_vline(xintercept = 0, linetype = \"dashed\") + \n    geom_vline(xintercept = 0.035, linetype = \"dashed\") +\n    labs(caption=str_glue(\"For treatment arm sample sizes: n0=\",\n    round(n_0, 0), \", n1=\", round(n_1, 0)))\n\n\n\n\n\nShow R code\ndata_power$y <- round(data_power$y, 2)\ndata_power %>%\n    filter(delta %in% c(\"0\", \"0.035\"))\n\n\n   delta    y                  type\n1  0.000 0.83   Bayes: Enthusiastic\n2  0.035 0.06   Bayes: Enthusiastic\n3  0.000 0.78      Bayes: Skeptical\n4  0.035 0.04      Bayes: Skeptical\n5  0.000 0.90    Bayes: Informative\n6  0.035 0.11    Bayes: Informative\n7  0.000 0.80 Bayes: Noninformative\n8  0.035 0.05 Bayes: Noninformative\n9  0.000 0.80           Frequentist\n10 0.035 0.05           Frequentist\n\n\nThe Bayesian probability to reject \\(H_0: \\delta>\\delta^*\\) given \\(\\delta=p_1-p_0=0\\) and an informative prior is 90%. This is higher than the frequentist probability to reject of 80% given \\(\\delta=p_1-p_0=0\\). In contrast, the probability to reject \\(H_0: \\delta>\\delta^*\\) for \\(\\delta=0.035\\) under an informative prior is 11%. This is higher than the frequentist ‘type-I error’ of 5%. The probability to reject under the null hypothesis is higher for the Bayesian approach under an informative prior because the prior has substantial believe in non-inferiority.\n\nThe average (marginal) Bayesian probability to reject (BAP) can be calculated as \\[\n\\begin{aligned}\nBAP&=\\int_{-\\infty}^{-z_{1-\\epsilon}\\frac{\\sigma_{treat}}{\\sigma_{prior}}\\sqrt{\\sigma^2_{treat}+\\sigma^2_{prior}}+\\delta^*\\left(1+\\frac{\\sigma_{treat}^2}{\\sigma_{prior}^2}\\right)-\\frac{\\sigma^2_{treat}}{\\sigma^2_{prior}}d} f(\\tilde \\delta)d\\tilde \\delta\n\\\\&=\\Phi\\left( -z_{1-\\epsilon}\\frac{\\sigma_{treat}}{\\sigma_{prior}}\\frac{\\sqrt{\\sigma^2_{treat}+\\sigma^2_{prior}}}{\\sqrt{\\sigma^2_{treat}+\\sigma^2_{prior}}}+\\frac{\\delta^*}{\\sqrt{\\sigma^2_{treat}+\\sigma^2_{prior}}}\\left\\{1+\\frac{\\sigma_{treat}^2}{\\sigma_{prior}^2}\\right\\} \\right. \\\\\n  & \\left. \\quad \\quad \\quad-\\frac{d}{\\sqrt{\\sigma^2_{treat}+\\sigma^2_{prior}}}\\left\\{1+\\frac{\\sigma_{treat}^2}{\\sigma_{prior}^2}\\right\\}\\right) \\\\\n&=\\Phi\\left(-z_{1-\\epsilon}\\frac{\\sigma_{treat}}{\\sigma_{prior}}-\\frac{\\sqrt{\\sigma^2_{treat}+\\sigma^2_{prior}}}{\\sigma^2_{prior}}(d-\\delta^*)\\right),\n\\end{aligned}\n\\] since the posterior predictive distribution \\(\\tilde D \\sim N(d, \\sigma_{treat}^2+\\sigma_{prior}^2)\\).\n\nSpecial case\nIf \\(n_0=n_1=n\\) and \\(\\sigma_1^2=\\sigma_0^2=\\sigma^2\\), then \\(\\sigma_{treat}^2=\\frac{2\\sigma^2}{n}\\) and \\(\\sigma_{prior}^2=\\frac{2\\sigma^2}{m}\\), and the formula above reduces to \\[\n\\begin{aligned}\nBAP&=-z_{1-\\epsilon}\\sqrt{\\frac{m}{n}}-\\sqrt{\\frac{(m+n)m}{2n\\sigma^2}}(d-\\delta^*)\n\\end{aligned}\n\\]\n\n\nWorking example (continued)\nWe derive the average Bayesian probability to reject for the SAFE-SSPE study.\n\n\nShow R code\n### Hybrid AP\n\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\ndigit_round <- 4\n\n# Enthusiastic prior\nm <- 6.6\nprior_mean <- 0\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\n\nAP <- pnorm(1/sigma_prior * (-qnorm(1 - alpha) * sigma_treat -\n    (prior_mean - delta_star)))\n\ndata_output <- data.frame(type = \"Enthusiastic\", n_0, n_1, AP = round(AP,\n    digit_round))\n\n# Skeptical prior\nm <- 6.6\nprior_mean <- delta_star\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\n\nAP <- pnorm(1/sigma_prior * (-qnorm(1 - alpha) * sigma_treat -\n    (prior_mean - delta_star)))\n\ndata_output <- rbind(data_output, data.frame(type = \"Skeptical\",\n    n_0, n_1, AP = round(AP, digit_round)))\n\n# Informative prior\nm <- 25\nprior_mean <- 0\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\n\nAP <- pnorm(1/sigma_prior * (-qnorm(1 - alpha) * sigma_treat -\n    (prior_mean - delta_star)))\n\ndata_output <- rbind(data_output, data.frame(type = \"Informative\",\n    n_0, n_1, AP = round(AP, digit_round)))\n\n# Noninformative prior\nm <- 0.5\nprior_mean <- 0\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\n\nAP <- pnorm(1/sigma_prior * (-qnorm(1 - alpha) * sigma_treat -\n    (prior_mean - delta_star)))\n\ndata_output <- rbind(data_output, data.frame(type = \"Noninformative\",\n    n_0, n_1, AP = round(AP, digit_round)))\n\ndata_output <- data_output %>%\n    select(type, n_0, n_1, AP)\n\n### Bayesian AP\n\nsigma_treat <- sqrt((sd_0^2/n_0 + sd_1^2/n_1))\n\n# Enthusiastic prior\nprior_mean <- 0\nm <- 6.6\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\n\nap_bayes <- pnorm(-qnorm(1 - alpha) * sigma_treat/sigma_prior -\n    sqrt(sigma_treat^2 + sigma_prior^2)/sigma_prior^2 * (prior_mean -\n        delta_star))\n\ndata_output2 <- data.frame(type = \"Enthusiastic\", n_0, n_1, AP_bayes = round(ap_bayes,\n    digit_round))\n\n# Skeptical prior\nprior_mean <- delta_star\nm <- 6.6\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\n\nap_bayes <- pnorm(-qnorm(1 - alpha) * sigma_treat/sigma_prior -\n    sqrt(sigma_treat^2 + sigma_prior^2)/sigma_prior^2 * (prior_mean -\n        delta_star))\n\ndata_output2 <- rbind(data_output2, data.frame(type = \"Skeptical\",\n    n_0, n_1, AP_bayes = round(ap_bayes, digit_round)))\n\n# Informative prior\nprior_mean <- 0\nm <- 25\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\n\nap_bayes <- pnorm(-qnorm(1 - alpha) * sigma_treat/sigma_prior -\n    sqrt(sigma_treat^2 + sigma_prior^2)/sigma_prior^2 * (prior_mean -\n        delta_star))\n\ndata_output2 <- rbind(data_output2, data.frame(type = \"Informative\",\n    n_0, n_1, AP_bayes = round(ap_bayes, digit_round)))\n\n# Noninformative prior\nprior_mean <- 0\nm <- 0.5\nsigma_prior <- sqrt((sd_0^2 + sd_1^2))/sqrt(m)\n\nap_bayes <- pnorm(-qnorm(1 - alpha) * sigma_treat/sigma_prior -\n    sqrt(sigma_treat^2 + sigma_prior^2)/sigma_prior^2 * (prior_mean -\n        delta_star))\n\ndata_output2 <- rbind(data_output2, data.frame(type = \"Noninformative\",\n    n_0, n_1, AP_bayes = round(ap_bayes, digit_round)))\n\ndata_output <- left_join(data_output, data_output2 %>%\n    select(type, AP_bayes), by = \"type\")\n\ndata_output %>%\n    select(type, n_0, n_1, AP_hybrid = AP, AP_bayes)\n\n\n            type      n_0      n_1 AP_hybrid AP_bayes\n1   Enthusiastic 99.93031 99.93031    0.5856   0.5937\n2      Skeptical 99.93031 99.93031    0.3363   0.3363\n3    Informative 99.93031 99.93031    0.6631   0.7149\n4 Noninformative 99.93031 99.93031    0.5237   0.5239\n\n\nThe average Bayesian power under an informative prior is 72% compared to 66% from a hybrid approach.\n\n\n\n2.2.1.4 Hybrid approach: Prior on event probabilities\nIn the former subsections we assumed that the prior was directly specified on the treatment effect. In this subsection we assume that that design prior is specified on the event probabilities \\(p_i\\), \\(i=\\{0,1\\}\\). Suppose that the design priors on the event probabilities are beta distributed \\(\\pi_i \\sim Beta(a_i,b_i)\\), \\(i=\\{0,1\\}\\). It is well known (see for example [2] or [4]) that the prior predictive distribution of the number of events \\(R_i\\), \\(i=\\{0,1\\}\\), from \\(n_i\\) Bernoulli observations is beta-binomial distributed with \\(R_i \\sim betabinom(r_i|n_i, a_i, b_i)\\) and \\[\nE(R_i)=n_i\\frac{a_i}{a_i+b_i}, \\quad Var(R_i)=\\frac{n_ia_ib_i(n_i+a_i+b_i)}{(a_i+b_i)^2(a_i+b_i+1)}.\n\\]\n\nWorking example (continued)\nFor the SAFE-SSPE trial we specify the following design beta priors for the expected event probabilites \\(p_1=p_0=0.01\\).\nEnthusiastic prior: The beta prior for the active treatment arm is centered at 0.01 (the expected event proportion) with \\(P(\\pi_1> 0.05)=0.025\\), that is, the probability that the prior is greater than the safety margin is 2.5%. The mean of the beta prior for the control arm is centered at 0.03 (the safety margin) with \\(P(\\pi_0> 0.05)=0.05\\).\n\nParameters of beta prior for active treatment arm: \\(a_1=0.5\\), \\(b_1=49.5\\).\nParameters of beta prior for control treatment arm: \\(a_0=7.2\\), \\(b_0=232.8\\).\n\n\n\nShow R code\nlibrary(extraDistr)\n\np_1 <- 0.01\nx <- seq(0.001, 0.999, 0.001)\n\n## Enthusiastic prior\na_1 <- 0.5\nb_1 <- (1 - p_1)/p_1 * a_1\na_0 <- 7.2\nb_0 <- (1 - 0.03)/0.03 * a_0\n\nprior_0 <- dbeta(x, a_0, b_0)\nprior_1 <- dbeta(x, a_1, b_1)\n\nprior_plot <- data.frame(x, prior_0, prior_1)\nprior_plot_long <- pivot_longer(prior_plot, cols = c(prior_0, prior_1))\nprior_plot_long$group <- ifelse(str_detect(prior_plot_long$name, \"_0\") ==\n    T, \"Treatment arm 0\", \"Treatment arm 1\")\n\nfig1 <- ggplot(prior_plot_long, aes(x = x, y = value, colour = group)) +\n    geom_line(linewidth = 1.5) + theme_bw() + theme(panel.grid.minor = element_blank(),\n    legend.position = \"bottom\", legend.direction = \"horizontal\") + scale_x_continuous(limits = c(0,\n    0.1)) + ylab(\"Density\") + labs(caption = str_glue(\"Assumed event probabilities: Arm 0 (p_0=\",\n    p_0, \"), \", \"Arm 1 (p_1=\", p_1, \")\")) + scale_color_brewer(\"Treatment arm\",\n    palette = \"Set2\") + scale_linetype(\"Type\") + ggtitle(\"Enthusiastic prior\")\n\ndiff_prior <- data.frame(x = rbbinom(1e+06, size = ceiling(n_1), a_1,\n    b_1)/ceiling(n_1) - rbbinom(1e+06, size = ceiling(n_0), a_0, b_0)/ceiling(n_0))\n\nfig2 <- ggplot(diff_prior, aes(x), group=x) + geom_density(linewidth = 1.5, bw=0.1) + \n    theme_bw() + theme(panel.grid.minor = element_blank()) +\n    xlab(\"Difference from prior predictive distribution\") + ggtitle(\"Simulated distribution of difference from predicted event proportions\") +\n    ylab(\"Density\") + geom_vline(xintercept=delta_star, linetype=\"dashed\") +\n    geom_vline(xintercept=0, linetype=\"dotted\") +\n    scale_x_continuous(breaks=c(-0.5, -0.25, 0, 0.035, 0.25, 0.5), \n                       labels=c(-0.5, -0.25, 0, 0.035, 0.25, 0.5),\n                       limits=c(-0.5, 0.5))\n\ncowplot::plot_grid(fig1, fig2, align = \"h\", ncol = 1)\n\n\n\n\n\nSkeptical prior: The beta prior for the active treatment arm is centered at 0.05 (the safety margin) with \\(P(\\pi_1\\leq 0.01)=0.025\\), that is the probability that the prior is smaller or equal than the expected event proportion is 2.5%. The mean of the beta prior for the control arm is is centered at 0.01 (the expected event proportion) with \\(P(\\pi_0> 0.05)=0.025\\).\n\nParameters of beta prior for active treatment arm: \\(a_1=2.84\\), \\(b_1=53.96\\).\nParameters of beta prior for control treatment arm: \\(a_i=1.24\\), \\(b_i=122.76\\).\n\n\n\nShow R code\nx <- seq(0.001, 0.999, 0.001)\n\n# Skeptical\na_1 <- 2.84\nb_1 <- (1 - 0.05)/0.05 * a_1\na_0 <- 1.24\nb_0 <- (1 - 0.01)/0.01 * a_0\n\nprior_0 <- dbeta(x, a_0, b_0)\nprior_1 <- dbeta(x, a_1, b_1)\n\nprior_plot <- data.frame(x, prior_0, prior_1)\nprior_plot_long <- pivot_longer(prior_plot, cols = c(prior_0, prior_1))\n\nprior_plot_long$group <- ifelse(str_detect(prior_plot_long$name, \"_0\") ==\n    T, \"Treatment arm 0\", \"Treatment arm 1\")\n\nfig1 <- ggplot(prior_plot_long, aes(x = x, y = value, colour = group)) +\n    geom_line(linewidth = 1.5) + theme_bw() + theme(panel.grid.minor = element_blank(),\n    legend.position = \"bottom\", legend.direction = \"horizontal\") + scale_x_continuous(limits = c(0,\n    0.1)) + ylab(\"Density\") + labs(caption = str_glue(\"Assumed event probabilities: Arm 0 (p_0=\",\n    p_0, \"), \", \"Arm 1 (p_1=\", p_1, \")\")) + scale_color_brewer(\"Treatment arm\",\n    palette = \"Set2\") + scale_linetype(\"Type\") + ggtitle(\"Skeptical prior\")\n\ndiff_prior <- data.frame(x = rbbinom(1e+06, size = ceiling(n_1), a_1,\n    b_1)/ceiling(n_1) - rbbinom(1e+06, size = ceiling(n_0), a_0, b_0)/ceiling(n_0))\n\nfig2 <- ggplot(diff_prior, aes(x)) + geom_density(linewidth = 1.5, bw=0.1) + theme_bw() + \n    theme(panel.grid.minor = element_blank()) +\n    xlab(\"Difference from prior predictions\") + ggtitle(\"Simulated distribution of difference from predicted event proportions\") +\n    ylab(\"Density\") + geom_vline(xintercept=delta_star, linetype=\"dashed\") +\n    geom_vline(xintercept=0, linetype=\"dotted\") +\n    scale_x_continuous(breaks=c(-0.5, -0.25, 0, 0.035, 0.25, 0.5), \n                       labels=c(-0.5, -0.25, 0, 0.035, 0.25, 0.5),\n                       limits=c(-0.5, 0.5))\n\ncowplot::plot_grid(fig1, fig2, align = \"h\", ncol = 1)\n\n\n\n\n\nInformative prior: The beta prior for the active treatment arm and control arm is centered at 0.01 (the expected event proportion) with \\(P(\\pi_1\\leq 0.05)=0.01\\) and \\(P(\\pi_1\\leq 0.05)=0.05\\).\n\nParameters of beta prior for active treatment arm: \\(a_1=0.8\\), \\(b_1=79.2\\).\nParameters of beta prior for control treatment arm: \\(a_0=0.03\\), \\(b_0=2.97\\).\n\n\n\nShow R code\nx <- seq(0.001, 0.999, 0.001)\n\n## Informative prior\na_1 <- 0.8\nb_1 <- (1 - p_1)/p_1 * a_1\na_0 <- 0.03\nb_0 <- (1 - p_0)/p_0 * a_0\n\nprior_0 <- dbeta(x, a_0, b_0)\nprior_1 <- dbeta(x, a_1, b_1)\n\n\n\nprior_plot <- data.frame(x, prior_0, prior_1)\nprior_plot_long <- pivot_longer(prior_plot, cols = c(prior_0, prior_1))\n\nprior_plot_long$group <- ifelse(str_detect(prior_plot_long$name, \"_0\") ==\n    T, \"Treatment arm 0\", \"Treatment arm 1\")\n\nfig1 <- ggplot(prior_plot_long, aes(x = x, y = value, colour = group)) +\n    geom_line(linewidth = 1.5) + theme_bw() + theme(panel.grid.minor = element_blank(),\n    legend.position = \"bottom\", legend.direction = \"horizontal\") + scale_x_continuous(limits = c(0,\n    0.1)) + ylab(\"Density\") + labs(caption = str_glue(\"Assumed event probabilities: Arm 0 (p_0=\",\n    p_0, \"), \", \"Arm 1 (p_1=\", p_1, \")\")) + scale_color_brewer(\"Treatment arm\",\n    palette = \"Set2\") + scale_linetype(\"Type\") + ggtitle(\"Informative prior\")\n\ndiff_prior <- data.frame(x = rbbinom(1e+06, size = ceiling(n_1), a_1,\n    b_1)/ceiling(n_1) - rbbinom(1e+06, size = ceiling(n_0), a_0, b_0)/ceiling(n_0))\n\nfig2 <- ggplot(diff_prior, aes(x)) + geom_density(linewidth = 1.5, bw=0.1) + theme_bw() + \n    theme(panel.grid.minor = element_blank()) +\n    xlab(\"Difference from prior predictive distribution\") + ggtitle(\"Simulated distribution of difference from predicted event proportions\") +\n    ylab(\"Density\") + geom_vline(xintercept=delta_star, linetype=\"dashed\") +\n    geom_vline(xintercept=0, linetype=\"dotted\") +\n    scale_x_continuous(breaks=c(-0.5, -0.25, 0, 0.035, 0.25, 0.5), \n                       labels=c(-0.5, -0.25, 0, 0.035, 0.25, 0.5),\n                       limits=c(-0.5, 0.5))\n\ncowplot::plot_grid(fig1, fig2, align = \"h\", ncol = 1)\n\n\n\n\n\nNoninformative prior: Uniform prior for both, the active treatment arm and control arm.\n\nParameters of beta prior for active treatment arm: \\(a_1=1\\), \\(b_1=1\\).\nParameters of beta prior for control treatment arm: \\(a_0=1\\), \\(b_0=1\\).\n\n\n\nShow R code\n## Noninformative prior\na_0 <- 1\nb_0 <- 1\na_1 <- 1\nb_1 <- 1\n\nprior_0 <- dbeta(x, a_0, b_0)\nprior_1 <- dbeta(x, a_1, b_1)\n\nprior_plot <- data.frame(x, prior_0, prior_1)\nprior_plot_long <- pivot_longer(prior_plot, cols = c(prior_0, prior_1))\n\nprior_plot_long$group <- ifelse(str_detect(prior_plot_long$name, \"_0\") ==\n    T, \"Treatment arm 0\", \"Treatment arm 1\")\n\nfig1 <- ggplot(prior_plot_long, aes(x = x, y = value, colour = group)) +\n    geom_line(linewidth = 1.5) + theme_bw() + theme(panel.grid.minor = element_blank(),\n    legend.position = \"bottom\", legend.direction = \"horizontal\") + scale_x_continuous(limits = c(0,\n    0.1)) + ylab(\"Density\") + labs(caption = str_glue(\"Assumed event probabilities: Arm 0 (p_0=\",\n    p_0, \"), \", \"Arm 1 (p_1=\", p_1, \")\")) + scale_color_brewer(\"Treatment arm\",\n    palette = \"Set2\") + scale_linetype(\"Type\") + ggtitle(\"Noninformative prior\")\n\ndiff_prior <- data.frame(x = rbbinom(1e+06, size = ceiling(n_1), a_1,\n    b_1)/ceiling(n_1) - rbbinom(1e+06, size = ceiling(n_0), a_0, b_0)/ceiling(n_0))\n\nfig2 <- ggplot(diff_prior, aes(x)) + geom_density(linewidth = 1.5, bw=0.05) + theme_bw() + \n    theme(panel.grid.minor = element_blank()) +\n    xlab(\"Difference from prior predictive distribution\") + ggtitle(\"Simulated distribution of difference from predicted event proportions\") +\n    ylab(\"Density\") + geom_vline(xintercept=delta_star, linetype=\"dashed\") +\n    geom_vline(xintercept=0, linetype=\"dotted\") +\n    scale_x_continuous(breaks=c(-1, -0.5, 0, 0.5, 1), \n                       labels=c(-1, -0.5, 0,  0.5, 1),\n                       limits=c(-1, 1))\n\ncowplot::plot_grid(fig1, fig2, align = \"h\", ncol = 1)\n\n\n\n\n\n\nThe calculation of the average power is easily done by simulation.\n\n2.2.1.4.1 Simulation approach 1: Joint probability\nThe joint probability approach has been described in [4] and includes the following steps:\n\nCalculate the joint pdf for all pairs \\(r_i\\in\\{0, 1, \\cdots, n_i\\}\\), \\(i\\in\\{0,1\\}\\).\nThe sum of the joint predictive probabilites over \\(r_i\\) pairs where the \\((1-\\alpha)\\)-upper confidence limit of the risk difference is smaller than the non-inferiority margin is the average power.\n\nHere we use Agresti-Caffo confidence intervals for the risk difference [8].\n\n\nShow R code\nlibrary(extraDistr)\nlibrary(PropCIs)\n\nres_ap <- c()\n\n## Enthusiastic prior\n\na_1 <- 0.5\nb_1 <- (1 - p_1)/p_1 * a_1\na_0 <- 7.2\nb_0 <- (1 - 0.03)/0.03 * a_0\n\nr_0 <- 0:(ceiling(n_0)-1)\nr_1 <- 0:(ceiling(n_1)-1)\n\ndata_points <- expand.grid(r_1 = r_1, r_0 = r_0)\n\nset.seed(1)\ndata_points$pdf_r_1 <- dbbinom(data_points$r_1, size = ceiling(n_1), a_1,\n    b_1)\ndata_points$pdf_r_0 <- dbbinom(data_points$r_0, size = ceiling(n_0), a_0,\n    b_0)\ndata_points$joint_pdf <- data_points$pdf_r_1 * data_points$pdf_r_0\n\ndata_points$sig <- NA\n\nfor (i in 1:nrow(data_points)) {\n    data_points$sig[i] <- ifelse(wald2ci(data_points$r_1[i], n_1, data_points$r_0[i],\n        n_0, conf.level = 0.95, adjust = \"AC\")$conf.int[2] <= delta_star,\n        1, 0)\n}\n\nres_ap <- data.frame(type = \"Enthusiastic\", \n                            ap = sum(data_points$joint_pdf[data_points$sig == 1]))\n\n## Skeptical prior\n\na_1 <- 2.84\nb_1 <- (1 - 0.05)/0.05 * a_1\na_0 <- 1.24\nb_0 <- (1 - 0.01)/0.01 * a_0\n\nr_0 <- 0:(ceiling(n_0)-1)\nr_1 <- 0:(ceiling(n_1)-1)\n\ndata_points <- expand.grid(r_1 = r_1, r_0 = r_0)\n\nset.seed(1)\ndata_points$pdf_r_1 <- dbbinom(data_points$r_1, size = ceiling(n_1), a_1,\n    b_1)\ndata_points$pdf_r_0 <- dbbinom(data_points$r_0, size = ceiling(n_0), a_0,\n    b_0)\ndata_points$joint_pdf <- data_points$pdf_r_1 * data_points$pdf_r_0\n\ndata_points$sig <- NA\n\nfor (i in 1:nrow(data_points)) {\n    data_points$sig[i] <- ifelse(wald2ci(data_points$r_1[i], n_1, data_points$r_0[i],\n        n_0, conf.level = 0.95, adjust = \"AC\")$conf.int[2] <= delta_star,\n        1, 0)\n}\n\nres_ap <- rbind(res_ap, data.frame(type = \"Skeptical\", \n                          ap = sum(data_points$joint_pdf[data_points$sig == 1])))\n\n## Informative prior\n\na_1 <- 0.8\nb_1 <- (1 - p_1)/p_1 * a_1\na_0 <- 0.03\nb_0 <- (1 - p_0)/p_0 * a_0\n\nr_0 <- 0:(ceiling(n_0)-1)\nr_1 <- 0:(ceiling(n_1)-1)\n\ndata_points <- expand.grid(r_1 = r_1, r_0 = r_0)\n\nset.seed(1)\ndata_points$pdf_r_1 <- dbbinom(data_points$r_1, size = ceiling(n_1), a_1,\n    b_1)\ndata_points$pdf_r_0 <- dbbinom(data_points$r_0, size = ceiling(n_0), a_0,\n    b_0)\ndata_points$joint_pdf <- data_points$pdf_r_1 * data_points$pdf_r_0\n\ndata_points$sig <- NA\n\nfor (i in 1:nrow(data_points)) {\n    data_points$sig[i] <- ifelse(wald2ci(data_points$r_1[i], n_1, data_points$r_0[i],\n        n_0, conf.level = 0.95, adjust = \"AC\")$conf.int[2] <= delta_star,\n        1, 0)\n}\n\nres_ap <- rbind(res_ap, data.frame(type = \"Informative\", \n                          ap = sum(data_points$joint_pdf[data_points$sig == 1])))\n\n## Noninformative prior\n\na_1 <- 1\nb_1 <- 1\na_0 <- 1\nb_0 <- 1\n\nr_0 <- 0:(ceiling(n_0)-1)\nr_1 <- 0:(ceiling(n_1)-1)\n\ndata_points <- expand.grid(r_1 = r_1, r_0 = r_0)\n\nset.seed(1)\ndata_points$pdf_r_1 <- dbbinom(data_points$r_1, size = ceiling(n_1), a_1,\n    b_1)\ndata_points$pdf_r_0 <- dbbinom(data_points$r_0, size = ceiling(n_0), a_0,\n    b_0)\ndata_points$joint_pdf <- data_points$pdf_r_1 * data_points$pdf_r_0\n\ndata_points$sig <- NA\n\nfor (i in 1:nrow(data_points)) {\n    data_points$sig[i] <- ifelse(wald2ci(data_points$r_1[i], n_1, data_points$r_0[i],\n        n_0, conf.level = 0.95, adjust = \"AC\")$conf.int[2] <= delta_star,\n        1, 0)\n}\n\nres_ap <- rbind(res_ap, data.frame(type = \"Noninformative prior\", \n                          ap = sum(data_points$joint_pdf[data_points$sig == 1])))\nres_ap$ap <- round(res_ap$ap, 2)\n\nres_ap\n\n\n                  type   ap\n1         Enthusiastic 0.76\n2            Skeptical 0.09\n3          Informative 0.55\n4 Noninformative prior 0.42\n\n\n\n\n2.2.1.4.2 Simulation approach 2: Direct sampling from prior predictive distribution\nThe second simulation approach samples \\(q\\) event outcomes from the predictive distribution and calculates whether the \\((1-\\alpha)\\)-upper confidence limit of the risk difference is smaller than the non-inferiority margin. The sum of positive outcomes divided by the number of samples \\(q\\) gives the average power. Also here we use Agresti-Caffo confidence intervals for the risk difference [8].\n\n\nShow R code\n# Number of draws\nq <- 10000\n\nres_ap <- c()\n\n## Enthusiastic prior\n\na_1 <- 0.5\nb_1 <- (1 - p_1)/p_1 * a_1\na_0 <- 7.2\nb_0 <- (1 - 0.03)/0.03 * a_0\n\nset.seed(1)\nr_1 <- rbbinom(q, size = ceiling(n_1), a_1, b_1)\nr_0 <- rbbinom(q, size = ceiling(n_0), a_0, b_0)\n\nres <- c()\n\nfor (i in 1:length(r_1)) {\n    res <- c(res, ifelse(wald2ci(r_1[i], n_1, r_0[i], n_0, conf.level = 0.95,\n        adjust = \"AC\")$conf.int[2] <= delta_star, 1, 0))\n}\n\nres_ap <- data.frame(type = \"Enthusiastic\", ap = sum(res)/q)\n\n## Skeptical prior\n\na_1 <- 2.84\nb_1 <- (1 - 0.05)/0.05 * a_1\na_0 <- 1.24\nb_0 <- (1 - p_0)/p_0 * a_0\n\nset.seed(1)\nr_1 <- rbbinom(q, size = ceiling(n_1), a_1, b_1)\nr_0 <- rbbinom(q, size = ceiling(n_0), a_0, b_0)\n\nres <- c()\n\nfor (i in 1:length(r_1)) {\n    res <- c(res, ifelse(wald2ci(r_1[i], n_1, r_0[i], n_0, conf.level = 0.95,\n        adjust = \"AC\")$conf.int[2] <= delta_star, 1, 0))\n}\n\nres_ap <- rbind(res_ap, data.frame(type = \"Skeptical\", ap = sum(res)/q))\n\n## Informative prior\n\na_1 <- 0.8\nb_1 <- (1 - p_1)/p_1 * a_1\na_0 <- 0.03\nb_0 <- (1 - p_0)/p_0 * a_0\n\nset.seed(1)\nr_1 <- rbbinom(q, size = ceiling(n_1), a_1, b_1)\nr_0 <- rbbinom(q, size = ceiling(n_0), a_0, b_0)\n\nres <- c()\n\nfor (i in 1:length(r_1)) {\n    res <- c(res, ifelse(wald2ci(r_1[i], n_1, r_0[i], n_0, conf.level = 0.95,\n        adjust = \"AC\")$conf.int[2] <= delta_star, 1, 0))\n}\n\nres_ap <- rbind(res_ap, data.frame(type = \"Informative\", ap = sum(res)/q))\n\n## Noninformative prior\n\na_0 <- 1\nb_0 <- 1\na_1 <- 1\nb_1 <- 1\n\nset.seed(1)\nr_1 <- rbbinom(q, size = ceiling(n_1), a_1, b_1)\nr_0 <- rbbinom(q, size = ceiling(n_0), a_0, b_0)\n\nres <- c()\n\nfor (i in 1:length(r_1)) {\n    res <- c(res, ifelse(wald2ci(r_1[i], n_1, r_0[i], n_0, conf.level = 0.95,\n        adjust = \"AC\")$conf.int[2] <= delta_star, 1, 0))\n}\n\nres_ap <- rbind(res_ap, data.frame(type = \"Noninformative\", ap = sum(res)/q))\n\nres_ap$ap <- round(res_ap$ap, 2)\nres_ap\n\n\n            type   ap\n1   Enthusiastic 0.76\n2      Skeptical 0.09\n3    Informative 0.55\n4 Noninformative 0.42\n\n\n\n\n\n2.2.1.5 Bayesian approach: Prior on event probabilities\nIn the former subsection we assumed that the prior was directly specified on the treatment effect. In this subsection we assume that that design prior is specified on the event probabilities \\(p_i\\), \\(i=\\{0,1\\}\\). Suppose that the priors on the event probability are beta distributed \\(\\pi_i \\sim Beta(a_i,b_i)\\), then the posterior distribution is \\[\np_i|\\pi_i \\sim Beta\\left(a_i+\\sum_{k\\leq n_i}Y_{i,k},b_i+n_i-\\sum_{k\\leq n_i}Y_{i,k}\\right)\n\\] with \\[\n\\mu_{i,\\pi_i}:=E(p_i|\\pi_i)=\\frac{a_i+\\sum_{k\\leq n_i}Y_{i,k}}{a_i+b_i+n_i}, \\quad \\sigma_{i,\\pi_i}^2:=Var(p_i|\\pi_i)=\\frac{\\left(a_i+\\sum_{k\\leq n_i}Y_{i,k}\\right)\\left(b_i+n_i-\\sum_{k\\leq n_i}Y_{i,k}\\right)}{(a_i+b_i+n_i)^2(a_i+b_i+n_i+1)}.\n\\]\n\nWorking example (continued)\nWe use the same prior specifications as from the former subsection for the analysis priors.\nEnthusiastic prior: The beta prior for the active treatment arm is centered at 0.01 (the expected event proportion) with \\(P(\\pi_1> 0.05)=0.025\\), that is, the probability that the prior is greater than the safety margin is 2.5%. The mean of the beta prior for the control arm is centered at 0.03 (the safety margin) with \\(P(\\pi_0> 0.05)=0.05\\).\n\nParameters of beta prior for active treatment arm: \\(a_1=0.5\\), \\(b_1=49.5\\).\nParameters of beta prior for control treatment arm: \\(a_0=7.2\\), \\(b_0=232.8\\).\n\n\n\nShow R code\nx <- seq(0.001, 0.999, 0.001)\n\n## Enthusiastic prior\na_1 <- 0.5\nb_1 <- (1 - p_1)/p_1 * a_1\na_0 <- 7.2\nb_0 <- (1 - 0.03)/0.03 * a_0\n\nprior_0 <- dbeta(x, a_0, b_0)\nprior_1 <- dbeta(x, a_1, b_1)\nposterior_0 <- dbeta(x, a_0 + n_0 * p_0, b_0 + n_0 - n_0 * p_0)\nposterior_1 <- dbeta(x, a_1 + n_1 * p_1, b_1 + n_1 - n_1 * p_1)\nvar_posterior_0 <- ((a_0 + n_0 * p_0) * (b_0 + n_0 - n_0 * p_0))/((a_0 +\n    b_0 + n_0)^2 * (a_0 + b_0 + n_0 + 1))\nvar_posterior_1 <- ((a_1 + n_1 * p_1) * (b_1 + n_1 - n_1 * p_1))/((a_1 +\n    b_1 + n_1)^2 * (a_1 + b_1 + n_1 + 1))\n\nprior_plot <- data.frame(x, prior_0, prior_1, posterior_0, posterior_1)\nprior_plot_long <- pivot_longer(prior_plot, cols = c(prior_0, prior_1,\n    posterior_0, posterior_1))\nprior_plot_long$type <- ifelse(str_detect(prior_plot_long$name, \"posterior\") ==\n    T, \"Posterior\", \"Prior\")\nprior_plot_long$group <- ifelse(str_detect(prior_plot_long$name, \"_0\") ==\n    T, \"Treatment arm 0\", \"Treatment arm 1\")\n\nggplot(prior_plot_long, aes(x = x, y = value, linetype = type, colour = group)) +\n    geom_line(linewidth = 1.5) + theme_bw() + theme(panel.grid.minor = element_blank(),\n    legend.position = \"bottom\", legend.direction = \"vertical\") + scale_x_continuous(limits = c(0,\n    0.1)) + ylab(\"Density\") + labs(caption = str_glue(\"Assumed event probabilities: Arm 0 (p_0=\",\n    p_0, \"), \", \"Arm 1 (p_1=\", p_1, \")\\nPosterior standard deviation: Arm 0=\",\n    round(sqrt(var_posterior_0), 3), \", \", \"Arm 1=\", round(sqrt(var_posterior_1),\n        3))) + scale_color_brewer(\"Treatment arm\", palette = \"Set2\") +\n    scale_linetype(\"Type\") + ggtitle(\"Enthusiastic prior\")\n\n\n\n\n\nSkeptical prior: The beta prior for the active treatment arm is centered at 0.05 (the safety margin) with \\(P(\\pi_1\\leq 0.01)=0.025\\), that is the probability that the prior is smaller or equal than the expected event proportion is 2.5%. The mean of the beta prior for the control arm is is centered at 0.01 (the expected event proportion) with \\(P(\\pi_0> 0.05)=0.025\\).\n\nParameters of beta prior for active treatment arm: \\(a_1=2.84\\), \\(b_1=53.96\\).\nParameters of beta prior for control treatment arm: \\(a_i=1.24\\), \\(b_i=122.76\\).\n\n\n\nShow R code\nx <- seq(0.001, 0.999, 0.001)\n\n# Skeptical\na_1 <- 2.84\nb_1 <- (1 - 0.05)/0.05 * a_1\na_0 <- 1.24\nb_0 <- (1 - p_0)/p_0 * a_0\n\nprior_0 <- dbeta(x, a_0, b_0)\nprior_1 <- dbeta(x, a_1, b_1)\nposterior_0 <- dbeta(x, a_0 + n_0 * p_0, b_0 + n_0 - n_0 * p_0)\nposterior_1 <- dbeta(x, a_1 + n_1 * p_1, b_1 + n_1 - n_1 * p_1)\nvar_posterior_0 <- ((a_0 + n_0 * p_0) * (b_0 + n_0 - n_0 * p_0))/((a_0 +\n    b_0 + n_0)^2 * (a_0 + b_0 + n_0 + 1))\nvar_posterior_1 <- ((a_1 + n_1 * p_1) * (b_1 + n_1 - n_1 * p_1))/((a_1 +\n    b_1 + n_1)^2 * (a_1 + b_1 + n_1 + 1))\n\nprior_plot <- data.frame(x, prior_0, prior_1, posterior_0, posterior_1)\nprior_plot_long <- pivot_longer(prior_plot, cols = c(prior_0, prior_1,\n    posterior_0, posterior_1))\nprior_plot_long$type <- ifelse(str_detect(prior_plot_long$name, \"posterior\") ==\n    T, \"Posterior\", \"Prior\")\nprior_plot_long$group <- ifelse(str_detect(prior_plot_long$name, \"_0\") ==\n    T, \"Treatment arm 0\", \"Treatment arm 1\")\n\nggplot(prior_plot_long, aes(x = x, y = value, linetype = type, colour = group)) +\n    geom_line(linewidth = 1.5) + theme_bw() + theme(panel.grid.minor = element_blank(),\n    legend.position = \"bottom\", legend.direction = \"vertical\") + scale_x_continuous(limits = c(0,\n    0.1)) + ylab(\"Density\") + labs(caption = str_glue(\"Expected event probabilities: Arm 0 (p_0=\",\n    p_0, \"), \", \"Arm 1 (p_1=\", p_1, \")\\nPosterior standard deviation: Arm 0=\",\n    round(sqrt(var_posterior_0), 3), \", \", \"Arm 1=\", round(sqrt(var_posterior_1),\n        3))) + scale_color_brewer(\"Treatment arm\", palette = \"Set2\") +\n    scale_linetype(\"Type\") + ggtitle(\"Skeptical prior\")\n\n\n\n\n\nInformative prior: The beta prior for the active treatment arm and control arm is centered at 0.01 (the expected event proportion) with \\(P(\\pi_1\\leq 0.05)=0.01\\) and \\(P(\\pi_1\\leq 0.05)=0.05\\).\n\nParameters of beta prior for active treatment arm: \\(a_1=0.8\\), \\(b_1=79.2\\).\nParameters of beta prior for control treatment arm: \\(a_0=0.03\\), \\(b_0=2.97\\).\n\n\n\nShow R code\nx <- seq(0.001, 0.999, 0.001)\n\n## Enthusiastic\na_1 <- 0.8\nb_1 <- (1 - p_1)/p_1 * a_1\na_0 <- 0.03\nb_0 <- (1 - p_0)/p_0 * a_0\n\nprior_0 <- dbeta(x, a_0, b_0)\nprior_1 <- dbeta(x, a_1, b_1)\nposterior_0 <- dbeta(x, a_0 + n_0 * p_0, b_0 + n_0 - n_0 * p_0)\nposterior_1 <- dbeta(x, a_1 + n_1 * p_1, b_1 + n_1 - n_1 * p_1)\nvar_posterior_0 <- ((a_0 + n_0 * p_0) * (b_0 + n_0 - n_0 * p_0))/((a_0 +\n    b_0 + n_0)^2 * (a_0 + b_0 + n_0 + 1))\nvar_posterior_1 <- ((a_1 + n_1 * p_1) * (b_1 + n_1 - n_1 * p_1))/((a_1 +\n    b_1 + n_1)^2 * (a_1 + b_1 + n_1 + 1))\n\nprior_plot <- data.frame(x, prior_0, prior_1, posterior_0, posterior_1)\nprior_plot_long <- pivot_longer(prior_plot, cols = c(prior_0, prior_1,\n    posterior_0, posterior_1))\nprior_plot_long$type <- ifelse(str_detect(prior_plot_long$name, \"posterior\") ==\n    T, \"Posterior\", \"Prior\")\nprior_plot_long$group <- ifelse(str_detect(prior_plot_long$name, \"_0\") ==\n    T, \"Treatment arm 0\", \"Treatment arm 1\")\n\nggplot(prior_plot_long, aes(x = x, y = value, linetype = type, colour = group)) +\n    geom_line(linewidth = 1.5) + theme_bw() + theme(panel.grid.minor = element_blank(),\n    legend.position = \"bottom\", legend.direction = \"vertical\") + scale_x_continuous(limits = c(0,\n    0.1)) + ylab(\"Density\") + labs(caption = str_glue(\"Assumed event probabilities: Arm 0 (p_0=\",\n    p_0, \"), \", \"Arm 1 (p_1=\", p_1, \")\\nPosterior standard deviation: Arm 0=\",\n    round(sqrt(var_posterior_0), 3), \", \", \"Arm 1=\", round(sqrt(var_posterior_1),\n        3))) + scale_color_brewer(\"Treatment arm\", palette = \"Set2\") +\n    scale_linetype(\"Type\") + ggtitle(\"Enthusiastic prior\")\n\n\n\n\n\nNoninformative prior: Uniform prior for both, the active treatment arm and control arm.\n\nParameters of beta prior for active treatment arm: \\(a_1=1\\), \\(b_1=1\\).\nParameters of beta prior for control treatment arm: \\(a_0=1\\), \\(b_0=1\\).\n\n\n\nShow R code\n## Uniform\na_0 <- 1\nb_0 <- 1\na_1 <- 1\nb_1 <- 1\n\nprior_0 <- dbeta(x, a_0, b_0)\nprior_1 <- dbeta(x, a_1, b_1)\nposterior_0 <- dbeta(x, a_0 + n_0 * p_0, b_0 + n_0 - n_0 * p_0)\nposterior_1 <- dbeta(x, a_1 + n_1 * p_1, b_1 + n_1 - n_1 * p_1)\nvar_posterior_0 <- ((a_0 + n_0 * p_0) * (b_0 + n_0 - n_0 * p_0))/((a_0 +\n    b_0 + n_0)^2 * (a_0 + b_0 + n_0 + 1))\nvar_posterior_1 <- ((a_1 + n_1 * p_1) * (b_1 + n_1 - n_1 * p_1))/((a_1 +\n    b_1 + n_1)^2 * (a_1 + b_1 + n_1 + 1))\n\nprior_plot <- data.frame(x, prior_0, prior_1, posterior_0, posterior_1)\nprior_plot_long <- pivot_longer(prior_plot, cols = c(prior_0, prior_1,\n    posterior_0, posterior_1))\nprior_plot_long$type <- ifelse(str_detect(prior_plot_long$name, \"posterior\") ==\n    T, \"Posterior\", \"Prior\")\nprior_plot_long$group <- ifelse(str_detect(prior_plot_long$name, \"_0\") ==\n    T, \"Treatment arm 0\", \"Treatment arm 1\")\n\nggplot(prior_plot_long, aes(x = x, y = value, linetype = type, colour = group)) +\n    geom_line(linewidth = 1.5) + theme_bw() + theme(panel.grid.minor = element_blank(),\n    legend.position = \"bottom\", legend.direction = \"vertical\") + scale_x_continuous(limits = c(0,\n    0.1)) + ylab(\"Density\") + labs(caption = str_glue(\"Assumed event probabilities: Arm 0 (p_0=\",\n    p_0, \"), \", \"Arm 1 (p_1=\", p_1, \")\\nPosterior standard deviation: Arm 0=\",\n    round(sqrt(var_posterior_0), 3), \", \", \"Arm 1=\", round(sqrt(var_posterior_1),\n        3))) + scale_color_brewer(\"Treatment arm\", palette = \"Set2\") +\n    scale_linetype(\"Type\") + ggtitle(\"Noninformative prior\")\n\n\n\n\n\n\n\n\n\n\n1. Kunzmann K, Grayling MJ, Lee KM, Robertson DS, Rufibach K, Wason JMS. A review of bayesian perspectives on sample size derivation for confirmatory trials. The American Statistician. 2021;75: 424–432. doi:10.1080/00031305.2021.1901782\n\n\n2. Spiegelhalter DJ, Abrams KR, Myles JP. Bayesian approaches to clinical trials and health‐care evaluation. Wiley; 2003. doi:10.1002/0470092602\n\n\n3. Baumgartner C, Klok FA, Carrier M, Limacher A, Moor J, Righini M, et al. Clinical surveillance vs. Anticoagulation for low-risk patiEnts with isolated SubSegmental pulmonary embolism: Protocol for a multicentre randomised placebo-controlled non-inferiority trial (SAFE-SSPE). BMJ Open. 2020;10: e040151. doi:10.1136/bmjopen-2020-040151\n\n\n4. Grieve AP. Hybrid frequentist/bayesian power and bayesian power in planning clinical trials. Chapman; Hall/CRC; 2022. doi:10.1201/9781003218531\n\n\n5. O’Hagan A, Stevens JW, Campbell MJ. Assurance in clinical trial design. Pharmaceutical Statistics. 2005;4: 187–201. doi:10.1002/pst.175\n\n\n6. Rufibach K, Burger HU, Abt M. Bayesian predictive power: Choice of prior and some recommendations for its use as probability of success in drug development. Pharmaceutical Statistics. 2016;15: 438–446. doi:10.1002/pst.1764\n\n\n7. Gelman A, Carlin JB, Stern HS, Dunson DB, Vehtari A, Rubin DB. Bayesian data analysis. Chapman; Hall/CRC; 2013. doi:10.1201/b16018\n\n\n8. Agresti A, Caffo B. Simple and effective confidence intervals for proportions and differences of proportions result from adding two successes and two failures. The American Statistician. 2000;54: 280. doi:10.2307/2685779"
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "1. Kunzmann K, Grayling MJ, Lee KM, Robertson DS,\nRufibach K, Wason JMS. A review of bayesian perspectives on sample size\nderivation for confirmatory trials. The American Statistician. 2021;75:\n424–432. doi:10.1080/00031305.2021.1901782\n\n\n2. Spiegelhalter DJ, Abrams KR, Myles JP. Bayesian\napproaches to clinical trials and health‐care evaluation. Wiley; 2003.\ndoi:10.1002/0470092602\n\n\n3. Baumgartner C, Klok FA, Carrier M, Limacher A,\nMoor J, Righini M, et al. Clinical surveillance vs. Anticoagulation for\nlow-risk patiEnts with isolated SubSegmental pulmonary embolism:\nProtocol for a multicentre randomised placebo-controlled non-inferiority\ntrial (SAFE-SSPE). BMJ Open. 2020;10: e040151. doi:10.1136/bmjopen-2020-040151\n\n\n4. Rufibach K, Burger HU, Abt M. Bayesian\npredictive power: Choice of prior and some recommendations for its use\nas probability of success in drug development. Pharmaceutical\nStatistics. 2016;15: 438–446. doi:10.1002/pst.1764\n\n\n5. O’Hagan A, Stevens JW, Campbell MJ. Assurance\nin clinical trial design. Pharmaceutical Statistics. 2005;4: 187–201.\ndoi:10.1002/pst.175\n\n\n6. Grieve AP. Hybrid frequentist/bayesian power\nand bayesian power in planning clinical trials. Chapman; Hall/CRC; 2022.\ndoi:10.1201/9781003218531\n\n\n7. Gelman A, Carlin JB, Stern HS, Dunson DB,\nVehtari A, Rubin DB. Bayesian data analysis. Chapman; Hall/CRC; 2013.\ndoi:10.1201/b16018\n\n\n8. Agresti A, Caffo B. Simple and effective\nconfidence intervals for proportions and differences of proportions\nresult from adding two successes and two failures. The American\nStatistician. 2000;54: 280. doi:10.2307/2685779"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Bayesian approaches in clinical trials",
    "section": "",
    "text": "1 Introduction"
  },
  {
    "objectID": "index.html#general-notation-and-abbreviations",
    "href": "index.html#general-notation-and-abbreviations",
    "title": "Bayesian approaches in clinical trials",
    "section": "1.1 General notation and abbreviations",
    "text": "1.1 General notation and abbreviations\n\niid: independent and identically distributed\npdf: probability density function\n\\(N_2\\): Bivariate cumulative Gaussian distribution function\n\\(\\phi\\): Probability density function of the standard Gaussian distribution\n\\(\\Phi\\): Cumulative distribution function of the standard Gaussian distribution\n\\(\\Phi^{-1}\\): Quantile function of the standard Gaussian distribution function"
  },
  {
    "objectID": "index.html#power-vocabulary",
    "href": "index.html#power-vocabulary",
    "title": "Bayesian approaches in clinical trials",
    "section": "1.2 ‘Power’ vocabulary",
    "text": "1.2 ‘Power’ vocabulary\nIn their supplement Kunzmann et al. [1] provide a literature review of the terminology used in articles. We provide here a summary of this terminology:\n\nFrequentist power: Probability of rejection given that the alternative hypothesis is true.\nAverage power: Prior averaged probability of rejection. Often also called ‘probability of success’, ‘assurance’, ‘Bayesian predictive power’.\nPrior adjusted power: Joint probability of rejection and that the treatment effect is effective."
  },
  {
    "objectID": "index.html#some-bayesian-concepts",
    "href": "index.html#some-bayesian-concepts",
    "title": "Bayesian approaches in clinical trials",
    "section": "1.3 Some ‘Bayesian’ concepts",
    "text": "1.3 Some ‘Bayesian’ concepts\n\nDesign prior: Priors used before data collection as data generating mode [2].\nAnalysis prior: Priors used for Bayesian analysis of the collected data [2].\nPrior predictive distribution: Situation before a sample was taken. Let \\(\\theta\\) be a realisation of a random variable \\(\\Theta\\) with pdf \\(p(\\theta)\\). Then for a future observation \\(\\tilde X\\)\n\n\\[\np(\\tilde x)=\\int_\\Theta p(\\tilde x, \\theta)d\\theta=\\int_\\Theta \\underbrace{p(\\tilde x | \\theta)}_{likelihood}\\underbrace{p(\\theta)}_{prior}d\\theta\n\\]\n\nPosterior predictive distribution: Situation after a sample was taken. Let \\(\\theta\\) be a realisation of a random variable \\(\\Theta\\) with pdf \\(p(\\theta)\\). Then for a future observation \\(\\tilde X\\) and observed \\(X\\) (since \\(X\\) is independent \\(\\tilde X\\))\n\n\\[\np(\\tilde x|x)=\\int_\\Theta p(\\tilde x | \\theta, x)p(\\theta|x)d\\theta=\\int_\\Theta \\underbrace{p(\\tilde x | \\theta)}_{likelihood}\\underbrace{p(\\theta|x)}_{prior}d\\theta.\n\\]"
  },
  {
    "objectID": "index.html#used-r-libraries",
    "href": "index.html#used-r-libraries",
    "title": "Bayesian approaches in clinical trials",
    "section": "1.4 Used R libraries",
    "text": "1.4 Used R libraries\n\n\nShow R code\nlibrary(tidyverse)\nlibrary(epiR)\nlibrary(mvtnorm)\nlibrary(extraDistr)\nlibrary(PropCIs)\n\n\n\n\n\n\n1. Kunzmann K, Grayling MJ, Lee KM, Robertson DS, Rufibach K, Wason JMS. A review of bayesian perspectives on sample size derivation for confirmatory trials. The American Statistician. 2021;75: 424–432. doi:10.1080/00031305.2021.1901782\n\n\n2. Stefan AM, Gronau QF, Schönbrodt FD, Wagenmakers E-J. A tutorial on bayes factor design analysis using an informed prior. Behavior Research Methods. 2019;51: 1042–1058. doi:10.3758/s13428-018-01189-8"
  }
]